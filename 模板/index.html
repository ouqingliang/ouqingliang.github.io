<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.ico">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ouqingliang.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.12.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="[TOC]">
<meta property="og:type" content="article">
<meta property="og:title" content="模板">
<meta property="og:url" content="https://ouqingliang.github.io/%E6%A8%A1%E6%9D%BF/index.html">
<meta property="og:site_name" content="Oql&#39;s Blog">
<meta property="og:description" content="[TOC]">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-12-31T16:00:00.000Z">
<meta property="article:modified_time" content="2023-02-11T06:12:11.128Z">
<meta property="article:author" content="Oql">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://ouqingliang.github.io/%E6%A8%A1%E6%9D%BF/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://ouqingliang.github.io/%E6%A8%A1%E6%9D%BF/","path":"模板/","title":"模板"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>模板 | Oql's Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Oql's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">121</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">21</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">214</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">1.</span> <span class="nav-text">数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">1.1.</span> <span class="nav-text">字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%B1%95KMP"><span class="nav-number">1.1.1.</span> <span class="nav-text">扩展KMP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lyndon-%E5%88%86%E8%A7%A3"><span class="nav-number">1.1.2.</span> <span class="nav-text">Lyndon 分解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AC%E8%87%AA%E5%8A%A8%E6%9C%BA"><span class="nav-number">1.1.3.</span> <span class="nav-text">AC自动机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SAM"><span class="nav-number">1.1.4.</span> <span class="nav-text">SAM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SA"><span class="nav-number">1.1.5.</span> <span class="nav-text">SA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#manacher"><span class="nav-number">1.1.6.</span> <span class="nav-text">manacher</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PAM"><span class="nav-number">1.1.7.</span> <span class="nav-text">PAM</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%A8%E6%B0%8F%E5%9B%BE%E8%A1%A8"><span class="nav-number">1.2.</span> <span class="nav-text">杨氏图表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Treap"><span class="nav-number">1.3.</span> <span class="nav-text">Treap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LCT"><span class="nav-number">1.4.</span> <span class="nav-text">LCT</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#KD-Tree"><span class="nav-number">1.5.</span> <span class="nav-text">KD-Tree</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A6%E5%81%8F%E6%A0%91"><span class="nav-number">1.6.</span> <span class="nav-text">左偏树</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E5%AD%A6"><span class="nav-number">2.</span> <span class="nav-text">数学</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F"><span class="nav-number">2.1.</span> <span class="nav-text">数学公式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%AF%E7%89%B9%E6%9E%97%E6%95%B0"><span class="nav-number">2.1.1.</span> <span class="nav-text">斯特林数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B4%9D%E5%B0%94%E6%95%B0"><span class="nav-number">2.1.2.</span> <span class="nav-text">贝尔数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%AF%E5%8A%AA%E5%88%A9%E6%95%B0"><span class="nav-number">2.1.3.</span> <span class="nav-text">伯努利数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E4%B9%98"><span class="nav-number">2.2.</span> <span class="nav-text">快速乘</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ex-CRT-and-Pollard-rho"><span class="nav-number">2.3.</span> <span class="nav-text">ex_CRT and Pollard rho</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Powerful-Number"><span class="nav-number">2.4.</span> <span class="nav-text">Powerful Number</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97"><span class="nav-number">2.5.</span> <span class="nav-text">类欧几里得</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BSGS"><span class="nav-number">2.6.</span> <span class="nav-text">BSGS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A9%E5%B1%95Lucas"><span class="nav-number">2.7.</span> <span class="nav-text">扩展Lucas</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Min25%E7%AD%9B"><span class="nav-number">2.8.</span> <span class="nav-text">Min25筛</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E9%A1%B9%E5%BC%8F"><span class="nav-number">2.9.</span> <span class="nav-text">多项式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#FWT"><span class="nav-number">2.9.1.</span> <span class="nav-text">FWT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FFT"><span class="nav-number">2.9.2.</span> <span class="nav-text">FFT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%86%E7%B3%BB%E6%95%B0FFT"><span class="nav-number">2.9.3.</span> <span class="nav-text">拆系数FFT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NTT"><span class="nav-number">2.9.4.</span> <span class="nav-text">NTT</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0"><span class="nav-number">2.10.</span> <span class="nav-text">线性代数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A9%E9%98%B5%E7%9B%B8%E5%85%B3"><span class="nav-number">2.10.1.</span> <span class="nav-text">矩阵相关</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%BE%E8%AE%BA"><span class="nav-number">3.</span> <span class="nav-text">图论</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#KM%E7%AE%97%E6%B3%95"><span class="nav-number">3.1.</span> <span class="nav-text">KM算法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E6%B5%81"><span class="nav-number">3.2.</span> <span class="nav-text">网络流</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Dinic"><span class="nav-number">3.2.1.</span> <span class="nav-text">Dinic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dijkstra%E4%BC%98%E5%8C%96%E8%B4%B9%E7%94%A8%E6%B5%81"><span class="nav-number">3.2.2.</span> <span class="nav-text">Dijkstra优化费用流</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#K%E7%9F%AD%E8%B7%AF%EF%BC%88%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E5%8F%AF%E5%B9%B6%E5%A0%86%E4%BC%98%E5%8C%96%EF%BC%89"><span class="nav-number">3.3.</span> <span class="nav-text">K短路（可持久化可并堆优化）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E8%AE%A1%E6%95%B0%EF%BC%8CK4%E8%AE%A1%E6%95%B0"><span class="nav-number">3.4.</span> <span class="nav-text">环计数，K4计数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%A6%E5%9B%BE"><span class="nav-number">3.5.</span> <span class="nav-text">弦图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%B0%8F%E6%A0%91%E5%BD%A2%E5%9B%BE%EF%BC%88%E6%9C%B1-%E5%88%98%E7%AE%97%E6%B3%95%EF%BC%89"><span class="nav-number">3.6.</span> <span class="nav-text">最小树形图（朱-刘算法）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%A6%E8%8A%B1%E6%A0%91-O-n-3"><span class="nav-number">3.7.</span> <span class="nav-text">带花树 $O(n^3)$</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SCC"><span class="nav-number">3.8.</span> <span class="nav-text">SCC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BCC"><span class="nav-number">3.9.</span> <span class="nav-text">BCC</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A0%91%E8%AE%BA"><span class="nav-number">4.</span> <span class="nav-text">树论</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%99%9A%E6%A0%91"><span class="nav-number">4.1.</span> <span class="nav-text">虚树</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95"><span class="nav-number">5.</span> <span class="nav-text">计算几何</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Oql"
      src="/images/bear.jpg">
  <p class="site-author-name" itemprop="name">Oql</p>
  <div class="site-description" itemprop="description"></div>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ouqingliang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ouqingliang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1692110604@qq.com" title="E-Mail → mailto:1692110604@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ouqingliang.github.io/%E6%A8%A1%E6%9D%BF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bear.jpg">
      <meta itemprop="name" content="Oql">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Oql's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="模板 | Oql's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          模板
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2022-01-01T00:00:00+08:00">2022-01-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>[TOC]</p>
<span id="more"></span>

<h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><h3 id="扩展KMP"><a href="#扩展KMP" class="headerlink" title="扩展KMP"></a>扩展KMP</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">ll extend[N],ne[N],ans;</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="type">int</span> len;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getne</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(ne,<span class="number">0</span>,<span class="built_in">sizeof</span>(ne));</span><br><span class="line">    ne[<span class="number">0</span>]=len;</span><br><span class="line">    ll a,p;</span><br><span class="line">    a=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>( a&lt;len &amp;&amp; s[a]==s[a<span class="number">-1</span>]) a++;</span><br><span class="line">    ne[<span class="number">1</span>]=a<span class="number">-1</span>;</span><br><span class="line">    a=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;len;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        p=a+ne[a]<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>((i<span class="number">-1</span>)+ne[i-a]&lt;p) ne[i]=ne[i-a];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> j=<span class="built_in">max</span>(p-i+<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">while</span>(i+j&lt;len&amp;&amp;s[i+j]==s[j]) j++;</span><br><span class="line">            ne[i]=j; a=i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">exkmp</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">getne</span>();</span><br><span class="line">    ll a=<span class="number">0</span>,p;</span><br><span class="line">    p=len;</span><br><span class="line">    extend[<span class="number">0</span>]=p;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;len;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        p=a+extend[a]<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>((i<span class="number">-1</span>)+ne[i-a]&lt;p) extend[i]=ne[i-a];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> j=<span class="built_in">max</span>(p-i+<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">while</span>(j&lt;len&amp;&amp;i+j&lt;len&amp;&amp;s[i+j]==s[j]) j++;</span><br><span class="line">            extend[i]=j; a=i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Lyndon-分解"><a href="#Lyndon-分解" class="headerlink" title="Lyndon 分解"></a>Lyndon 分解</h3><p>最小表示的初始位置为 $s+s$ 的Lyndon分解中字符串初始位置 $\le |s|$ 且最大的那个。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s+<span class="number">1</span>); n=<span class="built_in">strlen</span>(s+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,j,k;i&lt;=n;)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">for</span>(j=i,k=i+<span class="number">1</span>;k&lt;=n&amp;&amp;s[j]&lt;=s[k];j=(s[j]==s[k++])?j+<span class="number">1</span>:i);</span><br><span class="line">	<span class="keyword">for</span>(;i&lt;=j;i+=k-j,ans^=(i<span class="number">-1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ans);</span><br></pre></td></tr></table></figure>

<h3 id="AC自动机"><a href="#AC自动机" class="headerlink" title="AC自动机"></a>AC自动机</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line"><span class="type">int</span> ne[N][Size],fail[N],cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getfail</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">ff</span>(i,<span class="number">0</span>,Size) <span class="keyword">if</span>(ne[<span class="number">0</span>][i]) q.<span class="built_in">push</span>(ne[<span class="number">0</span>][i]);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> u;!q.<span class="built_in">empty</span>();)</span><br><span class="line">	&#123;</span><br><span class="line">		u=q.<span class="built_in">front</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="built_in">ff</span>(i,<span class="number">0</span>,Size)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">int</span> v=ne[u][i];</span><br><span class="line">			<span class="keyword">if</span>(!v) ne[u][i]=ne[fail[u]][i];</span><br><span class="line">			<span class="keyword">else</span> fail[v]=ne[fail[u]][i],q.<span class="built_in">push</span>(v);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ins</span><span class="params">(<span class="type">char</span> *s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> n=<span class="built_in">strlen</span>(s+<span class="number">1</span>),u=<span class="number">0</span>,c;</span><br><span class="line">	<span class="built_in">fo</span>(i,<span class="number">1</span>,n)</span><br><span class="line">	&#123;</span><br><span class="line">		c=s[i]-<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">		<span class="keyword">if</span>(!ne[u][c]) ne[u][c]=++cnt;</span><br><span class="line">		u=ne[u][c];</span><br><span class="line">		<span class="comment">//do sth</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//do sth</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SAM"><a href="#SAM" class="headerlink" title="SAM"></a>SAM</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=siz;i++) <span class="built_in">memset</span>(ne[i],<span class="number">0</span>,<span class="built_in">sizeof</span>(ne[i])),fa[i]=len[i]=<span class="number">0</span>;</span><br><span class="line">    las=siz=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">extend</span><span class="params">(<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> cur=++siz;</span><br><span class="line">	len[cur]=len[las]+<span class="number">1</span>;</span><br><span class="line">	<span class="type">int</span> p=las;</span><br><span class="line">	<span class="keyword">for</span>(;p&amp;&amp;!ne[p][c];p=fa[p]) ne[p][c]=cur;</span><br><span class="line">	<span class="keyword">if</span>(!p) fa[cur]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">int</span> q=ne[p][c];</span><br><span class="line">		<span class="keyword">if</span>(len[q]==len[p]+<span class="number">1</span>) fa[cur]=q;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">int</span> clone=++siz;</span><br><span class="line">			len[clone]=len[p]+<span class="number">1</span>;</span><br><span class="line">			<span class="built_in">memcpy</span>(ne[clone],ne[q],<span class="built_in">sizeof</span>(ne[q]));</span><br><span class="line">			fa[clone]=fa[q];</span><br><span class="line">			<span class="keyword">for</span>(;p&amp;&amp;ne[p][c]==q;p=fa[p]) ne[p][c]=clone;</span><br><span class="line">			fa[cur]=fa[q]=clone;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	las=cur;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SA"><a href="#SA" class="headerlink" title="SA"></a>SA</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> k)</span></span>&#123;<span class="keyword">return</span> t[x]==t[y]&amp;&amp;t[x+k]==t[y+k];&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SuufixArray</span>&#123;</span><br><span class="line">    <span class="type">int</span> height[N],sa[N],rk[N],f[N][K],len; ll sum[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">rsort</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> m)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">        <span class="built_in">fo</span>(i,<span class="number">0</span>,m) base[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">fo</span>(i,<span class="number">1</span>,n) base[rk[t[i]]]++;</span><br><span class="line">        <span class="built_in">fo</span>(i,<span class="number">1</span>,m) base[i]+=base[i<span class="number">-1</span>];</span><br><span class="line">        <span class="built_in">fd</span>(i,n,<span class="number">1</span>) sa[base[rk[t[i]]]--]=t[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">char</span> *s,<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(t,<span class="number">0</span>,<span class="built_in">sizeof</span>(t));</span><br><span class="line">        len=n; s[n+<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">fo</span>(i,<span class="number">1</span>,n) t[i]=i,rk[i]=s[i]-<span class="string">&#x27;a&#x27;</span>+<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">rsort</span>(n,<span class="number">128</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> w=<span class="number">1</span>,p=<span class="number">0</span>;p&lt;n;w&lt;&lt;=<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            p=<span class="number">0</span>;</span><br><span class="line">            <span class="built_in">fo</span>(i,n-w+<span class="number">1</span>,n) t[++p]=i;</span><br><span class="line">            <span class="built_in">fo</span>(i,<span class="number">1</span>,n) <span class="keyword">if</span>(sa[i]&gt;w) t[++p]=sa[i]-w;</span><br><span class="line">            <span class="built_in">rsort</span>(n,p);</span><br><span class="line">            <span class="built_in">fo</span>(i,<span class="number">1</span>,n) t[i]=rk[i];</span><br><span class="line">            rk[sa[<span class="number">1</span>]]=p=<span class="number">1</span>;</span><br><span class="line">            <span class="built_in">fo</span>(i,<span class="number">2</span>,n) rk[sa[i]]=<span class="built_in">cmp</span>(sa[i],sa[i<span class="number">-1</span>],w)?p:++p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,j,k=<span class="number">0</span>;i&lt;=n;height[rk[i++]]=k)</span><br><span class="line">            <span class="keyword">for</span>(j=sa[rk[i]<span class="number">-1</span>],(k?(k--):<span class="number">0</span>);s[i+k]==s[j+k];k++);</span><br><span class="line">        <span class="built_in">fo</span>(i,<span class="number">1</span>,n) f[i][<span class="number">0</span>]=height[i],sum[i]=sum[i<span class="number">-1</span>]+(n-sa[i]+<span class="number">1</span>)-height[i];</span><br><span class="line">        <span class="built_in">fo</span>(j,<span class="number">1</span>,K<span class="number">-1</span>)</span><br><span class="line">            <span class="built_in">fo</span>(i,<span class="number">1</span>,n)</span><br><span class="line">            &#123;</span><br><span class="line">                f[i][j]=f[i][j<span class="number">-1</span>];</span><br><span class="line">                <span class="keyword">if</span>(i+(<span class="number">1</span>&lt;&lt;j)<span class="number">-1</span>&lt;=n) f[i][j]=<span class="built_in">min</span>(f[i][j],f[i+(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>))][j<span class="number">-1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">ask</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x==y) <span class="keyword">return</span> len-x+<span class="number">1</span>;</span><br><span class="line">        x=rk[x]; y=rk[y];</span><br><span class="line">        <span class="keyword">if</span>(x&gt;y) <span class="built_in">swap</span>(x,y);</span><br><span class="line">        x++; <span class="type">int</span> k=l2[y-x+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(f[x][k],f[y-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="manacher"><a href="#manacher" class="headerlink" title="manacher"></a>manacher</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">manacher</span><span class="params">(<span class="type">char</span> *a,<span class="type">int</span> *f)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">char</span> s[N];</span><br><span class="line">	<span class="type">int</span> n=<span class="built_in">strlen</span>(a); s[<span class="number">0</span>]=<span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) s[(i&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>]=a[i],s[(i&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>]=<span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">	<span class="type">int</span> id=<span class="number">0</span>,mx=<span class="number">0</span>,ans=<span class="number">0</span>;</span><br><span class="line">	n=n*<span class="number">2</span><span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(mx&gt;i) f[i]=<span class="built_in">min</span>(f[(id&lt;&lt;<span class="number">1</span>)-i],mx-i); <span class="keyword">else</span> f[i]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span>(i-f[i]&gt;=<span class="number">0</span> &amp;&amp; i+f[i]&lt;n &amp;&amp; s[i+f[i]] == s[i-f[i]]) f[i]++;</span><br><span class="line">		<span class="keyword">if</span>(i+f[i]&gt;mx) id=i,mx=i+f[i];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="PAM"><a href="#PAM" class="headerlink" title="PAM"></a>PAM</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> PAM&#123;</span><br><span class="line">	<span class="type">int</span> n,s[N],num[N],p,las,nex[N][S],fail[N],len[N],sz[N];</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=n;i++) s[i]=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=p;i++) len[i]=fail[i]=sz[i]=<span class="number">0</span>,<span class="built_in">memset</span>(nex[i],<span class="number">0</span>,<span class="built_in">sizeof</span>(nex[i]));</span><br><span class="line">		s[n=<span class="number">0</span>]=len[p=<span class="number">2</span>]=<span class="number">-1</span>;</span><br><span class="line">		fail[las=<span class="number">1</span>]=fail[<span class="number">2</span>]=<span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">getfail</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">for</span>(;s[n<span class="number">-1</span>-len[x]]!=s[n];x=fail[x]); <span class="keyword">return</span> x;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		s[++n]=c;</span><br><span class="line">		<span class="type">int</span> cur=<span class="built_in">getfail</span>(las);</span><br><span class="line">		<span class="keyword">if</span>(!nex[cur][c])</span><br><span class="line">		&#123;</span><br><span class="line">			len[++p]=len[cur]+<span class="number">2</span>;</span><br><span class="line">			fail[p]=nex[<span class="built_in">getfail</span>(fail[cur])][c];</span><br><span class="line">			<span class="keyword">if</span>(!fail[p]) fail[p]=<span class="number">1</span>;</span><br><span class="line">			nex[cur][c]=p;</span><br><span class="line">		&#125;</span><br><span class="line">		las=nex[cur][c];</span><br><span class="line">		sz[las]++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="杨氏图表"><a href="#杨氏图表" class="headerlink" title="杨氏图表"></a>杨氏图表</h2><p>插入一个数 $x$：</p>
<p>找到当前行中最小的比 $x$ 大的数 $y$：</p>
<ul>
<li>若有，$x$ 将 $y$ 替换，往下一行插入 $y$；</li>
<li>否则将 $x$ 放置在最后一个位置，并结束。</li>
</ul>
<h2 id="Treap"><a href="#Treap" class="headerlink" title="Treap"></a>Treap</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> Treap&#123;</span><br><span class="line">	<span class="type">int</span> son[N][<span class="number">2</span>],val[N],siz[N],rnd[N],cnt,root;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">newnode</span><span class="params">(<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="type">int</span> u=++cnt;</span><br><span class="line">		val[u]=v; siz[u]=<span class="number">1</span>; rnd[u]=<span class="built_in">rand</span>()+(<span class="built_in">rand</span>()&lt;&lt;<span class="number">15</span>);</span><br><span class="line">		<span class="keyword">return</span> u;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;siz[u]=siz[son[u][<span class="number">0</span>]]+siz[son[u][<span class="number">1</span>]]+<span class="number">1</span>;&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!x||!y) <span class="keyword">return</span> x+y;</span><br><span class="line">		<span class="keyword">if</span>(rnd[x]&lt;rnd[y]) &#123;son[x][<span class="number">1</span>]=<span class="built_in">merge</span>(son[x][<span class="number">1</span>],y);<span class="built_in">pushup</span>(x);<span class="keyword">return</span> x;&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;son[y][<span class="number">0</span>]=<span class="built_in">merge</span>(x,son[y][<span class="number">0</span>]);<span class="built_in">pushup</span>(y);<span class="keyword">return</span> y;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">split_val</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> k,<span class="type">int</span> &amp;x,<span class="type">int</span> &amp;y)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!u) <span class="keyword">return</span> <span class="built_in">void</span>(x=y=<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span>(val[u]&lt;=k) x=u,<span class="built_in">split_val</span>(son[x][<span class="number">1</span>],k,son[x][<span class="number">1</span>],y);</span><br><span class="line">		<span class="keyword">else</span> y=u,<span class="built_in">split_val</span>(son[y][<span class="number">0</span>],k,x,son[y][<span class="number">0</span>]);</span><br><span class="line">		<span class="built_in">pushup</span>(u);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">split_rank</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> k,<span class="type">int</span> &amp;x,<span class="type">int</span> &amp;y)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!u) <span class="keyword">return</span> <span class="built_in">void</span>(x=y=<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span>(k&lt;=siz[son[u][<span class="number">0</span>]]) y=u,<span class="built_in">split_rank</span>(son[y][<span class="number">0</span>],k,x,son[y][<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">else</span> x=u,<span class="built_in">split_rank</span>(son[x][<span class="number">1</span>],k-siz[son[u][<span class="number">0</span>]]<span class="number">-1</span>,son[x][<span class="number">1</span>],y);</span><br><span class="line">		<span class="built_in">pushup</span>(u);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">kth</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="type">int</span> s=siz[son[u][<span class="number">0</span>]]+<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>(s==k) <span class="keyword">return</span> u;</span><br><span class="line">		<span class="keyword">if</span>(s&lt;k) <span class="keyword">return</span> <span class="built_in">kth</span>(son[u][<span class="number">1</span>],k-s);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">kth</span>(son[u][<span class="number">0</span>],k);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> x,y,z,ans;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ins</span><span class="params">(<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">split_val</span>(root,v,x,y);</span><br><span class="line">		root=<span class="built_in">merge</span>(<span class="built_in">merge</span>(x,<span class="built_in">newnode</span>(v)),y);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">del</span><span class="params">(<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">split_val</span>(root,v,x,y);</span><br><span class="line">		<span class="built_in">split_val</span>(x,v<span class="number">-1</span>,x,z);</span><br><span class="line">		root=<span class="built_in">merge</span>(<span class="built_in">merge</span>(x,z=<span class="built_in">merge</span>(son[z][<span class="number">0</span>],son[z][<span class="number">1</span>])),y);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">rank</span><span class="params">(<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">split_val</span>(root,v<span class="number">-1</span>,x,y);</span><br><span class="line">		ans=siz[x]+<span class="number">1</span>;</span><br><span class="line">		root=<span class="built_in">merge</span>(x,y);</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Kth</span><span class="params">(<span class="type">int</span> v)</span> </span>&#123;<span class="keyword">return</span> val[<span class="built_in">kth</span>(root,v)];&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">pre</span><span class="params">(<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">split_val</span>(root,v<span class="number">-1</span>,x,y);</span><br><span class="line">		ans=val[<span class="built_in">kth</span>(x,siz[x])];</span><br><span class="line">		root=<span class="built_in">merge</span>(x,y);</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">nex</span><span class="params">(<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">split_val</span>(root,v,x,y);</span><br><span class="line">		ans=val[<span class="built_in">kth</span>(y,<span class="number">1</span>)];</span><br><span class="line">		root=<span class="built_in">merge</span>(x,y);</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="LCT"><a href="#LCT" class="headerlink" title="LCT"></a>LCT</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> LCT&#123;</span><br><span class="line">	<span class="type">int</span> ch[N][<span class="number">2</span>],fa[N]; <span class="type">bool</span> r[N];</span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> lc ch[u][0]</span></span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> rc ch[u][1]</span></span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> son(x) (ch[fa[x]][1]==x)</span></span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> isr(x) (ch[fa[x]][1]!=x&amp;&amp;ch[fa[x]][0]!=x)</span></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span>&#123;siz[u]=<span class="number">1</span>+siz[lc]+siz[rc]+si[u];&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">torev</span><span class="params">(<span class="type">int</span> u)</span></span>&#123;<span class="built_in">swap</span>(lc,rc); r[u]^=<span class="number">1</span>;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> u)</span></span>&#123;<span class="keyword">if</span>(r[u]) <span class="built_in">torev</span>(lc),<span class="built_in">torev</span>(rc),r[u]=<span class="number">0</span>;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="type">int</span> y=fa[x],z=fa[y],d=<span class="built_in">son</span>(x);</span><br><span class="line">		fa[x]=z; <span class="keyword">if</span>(!<span class="built_in">isr</span>(y)) ch[z][<span class="built_in">son</span>(y)]=x;</span><br><span class="line">		fa[ch[y][d]=ch[x][<span class="number">1</span>-d]]=y;</span><br><span class="line">		fa[ch[x][<span class="number">1</span>-d]=y]=x;</span><br><span class="line">		<span class="built_in">pushup</span>(y); <span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">int</span> u)</span></span>&#123;<span class="keyword">if</span>(!<span class="built_in">isr</span>(u)) <span class="built_in">push</span>(fa[u]); <span class="built_in">pushdown</span>(u);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;<span class="built_in">push</span>(x);<span class="keyword">for</span>(<span class="type">int</span> y=fa[x];!<span class="built_in">isr</span>(x);<span class="built_in">rotate</span>(x),y=fa[x]) <span class="keyword">if</span>(!<span class="built_in">isr</span>(y)) <span class="built_in">rotate</span>(<span class="built_in">son</span>(x)==<span class="built_in">son</span>(y)?y:x);<span class="built_in">pushup</span>(x);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">for</span>(<span class="type">int</span> y=<span class="number">0</span>;x;) <span class="built_in">splay</span>(x),si[x]+=siz[ch[x][<span class="number">1</span>]],ch[x][<span class="number">1</span>]=y,si[x]-=siz[y],<span class="built_in">pushup</span>(x),y=x,x=fa[x];&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">makeroot</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="built_in">access</span>(x);<span class="built_in">splay</span>(x);<span class="built_in">torev</span>(x);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="built_in">makeroot</span>(x);<span class="built_in">access</span>(y);<span class="built_in">splay</span>(y);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="built_in">makeroot</span>(x);<span class="built_in">makeroot</span>(y);fa[x]=y;si[y]+=siz[x];<span class="built_in">pushup</span>(y);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;<span class="built_in">split</span>(x,y);ch[y][<span class="number">0</span>]=fa[x]=<span class="number">0</span>;<span class="built_in">pushup</span>(y);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">findroot</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="built_in">access</span>(x);<span class="built_in">splay</span>(x);<span class="keyword">for</span>(;ch[x][<span class="number">0</span>];x=ch[x][<span class="number">0</span>]); <span class="keyword">return</span> x;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="KD-Tree"><a href="#KD-Tree" class="headerlink" title="KD-Tree"></a>KD-Tree</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n,o;</span><br><span class="line"><span class="type">int</span> a,b,c,d;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">point</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> v[<span class="number">2</span>];</span><br><span class="line">	<span class="built_in">point</span> ()&#123;&#125;</span><br><span class="line">	<span class="built_in">point</span> (<span class="type">int</span> x,<span class="type">int</span> y) &#123;v[<span class="number">0</span>]=x; v[<span class="number">1</span>]=y; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span> == (point a,point b) &#123;<span class="keyword">return</span> a.v[<span class="number">0</span>]==b.v[<span class="number">0</span>]&amp;&amp;a.v[<span class="number">1</span>]==b.v[<span class="number">1</span>]; &#125;</span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span> &lt;= (point a,point b) &#123;<span class="keyword">return</span> a.v[<span class="number">0</span>]&lt;=b.v[<span class="number">0</span>]&amp;&amp;a.v[<span class="number">1</span>]&lt;=b.v[<span class="number">1</span>]; &#125;</span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span> &lt; (point a,point b) &#123;<span class="keyword">return</span> a.v[<span class="number">0</span>]&lt;b.v[<span class="number">0</span>]||a.v[<span class="number">1</span>]&lt;b.v[<span class="number">1</span>]; &#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(point a,point b,<span class="type">int</span> c)</span> </span>&#123;<span class="keyword">return</span> a.v[c]&lt;b.v[c]; &#125;</span><br><span class="line"><span class="function">point <span class="title">min</span><span class="params">(point a,point b)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">point</span>(<span class="built_in">min</span>(a.v[<span class="number">0</span>],b.v[<span class="number">0</span>]),<span class="built_in">min</span>(a.v[<span class="number">1</span>],b.v[<span class="number">1</span>])); &#125;</span><br><span class="line"><span class="function">point <span class="title">max</span><span class="params">(point a,point b)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">point</span>(<span class="built_in">max</span>(a.v[<span class="number">0</span>],b.v[<span class="number">0</span>]),<span class="built_in">max</span>(a.v[<span class="number">1</span>],b.v[<span class="number">1</span>])); &#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span></span><br><span class="line">&#123;</span><br><span class="line">	point l,r,v;</span><br><span class="line">	<span class="type">int</span> lc,rc;</span><br><span class="line">	<span class="type">int</span> q,s;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> rt,la,nt,cnt;</span><br><span class="line">node t[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	t[u].s=t[u].q;t[u].l=t[u].v;t[u].r=t[u].v;</span><br><span class="line">	<span class="keyword">if</span> (t[u].lc)</span><br><span class="line">	&#123;</span><br><span class="line">		t[u].s+=t[t[u].lc].s;</span><br><span class="line">		t[u].l=<span class="built_in">min</span>(t[u].l,t[t[u].lc].l);</span><br><span class="line">		t[u].r=<span class="built_in">max</span>(t[u].r,t[t[u].lc].r);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (t[u].rc)</span><br><span class="line">	&#123;</span><br><span class="line">		t[u].s+=t[t[u].rc].s;</span><br><span class="line">		t[u].l=<span class="built_in">min</span>(t[u].l,t[t[u].rc].l);</span><br><span class="line">		t[u].r=<span class="built_in">max</span>(t[u].r,t[t[u].rc].r);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ins</span><span class="params">(<span class="type">int</span> &amp;u,<span class="type">int</span> d,point s,<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!u) &#123;u=++nt; t[u].l=s; t[u].r=s; t[u].v=s;&#125;</span><br><span class="line">	<span class="keyword">if</span> (s==t[u].v) &#123;t[u].s+=c; t[u].q+=c; <span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">cmp</span>(s,t[u].v,d)) <span class="built_in">ins</span>(t[u].lc,d^<span class="number">1</span>,s,c);</span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">ins</span>(t[u].rc,d^<span class="number">1</span>,s,c);</span><br><span class="line">	<span class="built_in">update</span>(u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qry</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> d,point l,point r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!u) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (l&lt;=t[u].l&amp;&amp;t[u].r&lt;=r) <span class="keyword">return</span> t[u].s;</span><br><span class="line">	<span class="keyword">if</span> (r&lt;t[u].l||t[u].r&lt;l) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> ret=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (l&lt;=t[u].v&amp;&amp;t[u].v&lt;=r) ret+=t[u].q;</span><br><span class="line">	ret+=<span class="built_in">qry</span>(t[u].lc,d^<span class="number">1</span>,l,r)+<span class="built_in">qry</span>(t[u].rc,d^<span class="number">1</span>,l,r);</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">kth</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k,<span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> a,b;</span><br><span class="line">	a=l; b=r;</span><br><span class="line">	point x=t[(l+r)&gt;&gt;<span class="number">1</span>].v;</span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">while</span> (<span class="built_in">cmp</span>(t[a].v,x,d)) a++;</span><br><span class="line">		<span class="keyword">while</span> (<span class="built_in">cmp</span>(x,t[b].v,d)) b--;</span><br><span class="line">		<span class="keyword">if</span> (a&lt;=b) <span class="built_in">swap</span>(t[a],t[b]),a++,b--;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (a&lt;=b);</span><br><span class="line">	<span class="keyword">if</span> (k&gt;=a&amp;&amp;a&lt;r) <span class="built_in">kth</span>(a,r,k,d);</span><br><span class="line">	<span class="keyword">if</span> (k&lt;=b&amp;&amp;l&lt;b) <span class="built_in">kth</span>(l,b,k,d);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mid</span><span class="params">(<span class="type">int</span> &amp;u,<span class="type">int</span> d,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l&gt;r) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span> (l==r)&#123;u=l;<span class="built_in">update</span>(u);<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="built_in">kth</span>(l,r,(l+r)&gt;&gt;<span class="number">1</span>,d);</span><br><span class="line">	u=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">mid</span>(t[u].lc,d^<span class="number">1</span>,l,u<span class="number">-1</span>); <span class="built_in">mid</span>(t[u].rc,d^<span class="number">1</span>,u+<span class="number">1</span>,r);</span><br><span class="line">	<span class="built_in">update</span>(u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rebuild</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=nt;i++) t[i].lc=t[i].rc=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">mid</span>(rt,<span class="number">0</span>,<span class="number">1</span>,nt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;o);</span><br><span class="line">		<span class="keyword">if</span> (o==<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;a,&amp;b,&amp;c);</span><br><span class="line">			a^=la;b^=la;c^=la;</span><br><span class="line">			<span class="built_in">ins</span>(rt,<span class="number">0</span>,<span class="built_in">point</span>(a,b),c);</span><br><span class="line">			cnt++;</span><br><span class="line">			<span class="keyword">if</span> (cnt%<span class="number">5000</span>==<span class="number">0</span>) <span class="built_in">rebuild</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (o==<span class="number">2</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>,&amp;a,&amp;b,&amp;c,&amp;d);</span><br><span class="line">			a^=la;b^=la;c^=la;d^=la;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,la=<span class="built_in">qry</span>(rt,<span class="number">0</span>,<span class="built_in">point</span>(a,b),<span class="built_in">point</span>(c,d)););</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (o==<span class="number">3</span>) <span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="左偏树"><a href="#左偏树" class="headerlink" title="左偏树"></a>左偏树</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">bool</span> flag[N];</span><br><span class="line"><span class="type">int</span> fa[N],val[N],dis[N],ls[N],rs[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> fa[x]==x?x:fa[x]=<span class="built_in">find</span>(fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!x||!y) <span class="keyword">return</span> x+y;</span><br><span class="line">	<span class="keyword">if</span>(val[x]&gt;val[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">	rs[x]=<span class="built_in">merge</span>(rs[x],y);</span><br><span class="line">	<span class="keyword">if</span>(dis[ls[x]]&lt;dis[rs[x]]) <span class="built_in">swap</span>(ls[x],rs[x]);</span><br><span class="line">	dis[x]=dis[rs[x]]+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pop</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	fa[x]=<span class="built_in">merge</span>(ls[x],rs[x]);</span><br><span class="line">	fa[fa[x]]=fa[x]; ls[x]=rs[x]=val[x]=dis[x]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	dis[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">	n=<span class="built_in">read</span>();</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) val[i]=<span class="built_in">read</span>(),fa[i]=i;</span><br><span class="line">	<span class="type">char</span> s[<span class="number">10</span>];</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> T=<span class="built_in">read</span>(),x,y,fx,fy;T--;)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s);</span><br><span class="line">		<span class="keyword">if</span>(s[<span class="number">0</span>]==<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			x=<span class="built_in">read</span>(); y=<span class="built_in">read</span>();</span><br><span class="line">			<span class="keyword">if</span>(flag[x]||flag[y]) <span class="keyword">continue</span>;</span><br><span class="line">			fx=<span class="built_in">find</span>(x); fy=<span class="built_in">find</span>(y);</span><br><span class="line">			<span class="keyword">if</span>(fx==fy) <span class="keyword">continue</span>;</span><br><span class="line">			fa[fx]=fa[fy]=<span class="built_in">merge</span>(fx,fy);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(flag[x=<span class="built_in">read</span>()]) &#123;<span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>); <span class="keyword">continue</span>;&#125;</span><br><span class="line">			flag[x=<span class="built_in">find</span>(x)]=<span class="number">1</span>;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,val[x]);</span><br><span class="line">			<span class="built_in">pop</span>(x);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="数学"><a href="#数学" class="headerlink" title="数学"></a>数学</h1><h2 id="数学公式"><a href="#数学公式" class="headerlink" title="数学公式"></a>数学公式</h2><h3 id="斯特林数"><a href="#斯特林数" class="headerlink" title="斯特林数"></a>斯特林数</h3><p>$ S_2(n,k) &#x3D; S_2(n-1,k-1) + k S_2(n-1,k)$</p>
<p>$ S_2(n,m)&#x3D;\frac{1}{m!}\sum_{i&#x3D;0}^m(-1)^{m-i}\binom{m}{i}i^n$</p>
<p>$ S_1(n,k) &#x3D; S_1(n-1,k-1) + (n-1) S_1(n-1,k) $</p>
<p>$ F_n(x) &#x3D; \sum_{i&#x3D;0}^n S_1(n,i) x^i &#x3D; \prod_{i&#x3D;0}^{n-1}  (x+i) $</p>
<p>$ x^{\overline{n}}&#x3D;\sum_{k} S_1(n,k)x^k $</p>
<p>$ x^n&#x3D;\sum_{k} S_2(n,k)  (-1)^{n-k}  x^{\overline{  k }  } $</p>
<p>$ x^{\underline{n}}&#x3D;\sum_{k} S_1(n,k) (-1) ^ { n- k } x^k $</p>
<p>$ x^n&#x3D;\sum_{k} S_2(n,k) x^{\underline{  k }  } $</p>
<h3 id="贝尔数"><a href="#贝尔数" class="headerlink" title="贝尔数"></a>贝尔数</h3><p>$B_{n+1} &#x3D; \sum_{k&#x3D;0}^n\binom{n}{k} B_k$</p>
<p>$B_n &#x3D; \sum_{k&#x3D;0}^n S_2(n,k)$</p>
<h3 id="伯努利数"><a href="#伯努利数" class="headerlink" title="伯努利数"></a>伯努利数</h3><p>$S_m(n) &#x3D; \sum_{k&#x3D;0}^{n-1} k^m &#x3D; \frac{1}{m+1} \sum_{k&#x3D;0}^m \binom{m+1}{k}B_kn^{m+1-k}$</p>
<p>$B(x) &#x3D; \sum_{i} \frac{B_i}{i!}x^i &#x3D; \frac{x}{e^x-1}$.</p>
<h2 id="快速乘"><a href="#快速乘" class="headerlink" title="快速乘"></a>快速乘</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">mul</span><span class="params">(<span class="type">const</span> ll &amp;a,<span class="type">const</span> ll &amp;b,<span class="type">const</span> ll &amp;p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	ll d=((<span class="type">long</span> <span class="type">double</span>)a/p*b+<span class="number">1e-9</span>),res=a*b-d*p;</span><br><span class="line">	<span class="keyword">return</span> res&lt;<span class="number">0</span>?res+p:res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ex-CRT-and-Pollard-rho"><a href="#ex-CRT-and-Pollard-rho" class="headerlink" title="ex_CRT and Pollard rho"></a>ex_CRT and Pollard rho</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">mul</span><span class="params">(ll a,ll b,<span class="type">const</span> ll &amp;p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	ll ans=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(a%=p,b%=p;b;)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(b&amp;<span class="number">1</span>) &#123;ans+=a; <span class="keyword">if</span>(ans&gt;=p) ans-=p;&#125;</span><br><span class="line">		b&gt;&gt;=<span class="number">1</span>; a+=a; <span class="keyword">if</span>(a&gt;=p) a-=p;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">Pow</span><span class="params">(ll a,ll b,<span class="type">const</span> ll &amp;p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	ll ans=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(;b;b&gt;&gt;=<span class="number">1</span>,a=<span class="built_in">mul</span>(a,a,p)) <span class="keyword">if</span>(b&amp;<span class="number">1</span>) ans=<span class="built_in">mul</span>(ans,a,p);</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">gcd</span><span class="params">(ll x,ll y)</span></span>&#123;<span class="keyword">return</span> !y?x:<span class="built_in">gcd</span>(y,x%y);&#125;</span><br><span class="line"><span class="function">ll <span class="title">ex_gcd</span><span class="params">(ll a,ll b,ll &amp;x,ll &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!b) &#123;x=<span class="number">1</span>; y=<span class="number">0</span>; <span class="keyword">return</span> a;&#125;</span><br><span class="line">    ll d=<span class="built_in">ex_gcd</span>(b,a%b,y,x);</span><br><span class="line">    y-=a/b*x; <span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">inv</span><span class="params">(ll a,ll m)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll x,y,d;</span><br><span class="line">    d=<span class="built_in">ex_gcd</span>(a,m,x,y);</span><br><span class="line">    <span class="keyword">return</span> (x+m)%m;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> QuadraticResidue&#123;</span><br><span class="line">	ll mod,n,w;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">num</span>&#123;</span><br><span class="line">		ll a,b;</span><br><span class="line">		<span class="keyword">friend</span> <span class="keyword">inline</span> num <span class="keyword">operator</span> *(<span class="type">const</span> num &amp;A,<span class="type">const</span> num &amp;B)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> (num)&#123;(A.a*B.a+A.b*B.b%mod*w)%mod,(A.b*B.a+A.a*B.b)%mod&#125;;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> ll <span class="title">Pow</span><span class="params">(num x,ll y)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		num ans=(num)&#123;<span class="number">1</span>,<span class="number">0</span>&#125;;</span><br><span class="line">		<span class="keyword">for</span>(;y;y&gt;&gt;=<span class="number">1</span>,x=x*x) <span class="keyword">if</span>(y&amp;<span class="number">1</span>) ans=ans*x;</span><br><span class="line">		<span class="keyword">return</span> ans.a;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> ll <span class="title">L</span><span class="params">(ll x)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		ll ans=<span class="built_in">Pow</span>(x,(mod<span class="number">-1</span>)&gt;&gt;<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span> (ans==mod<span class="number">-1</span>)?<span class="number">-1</span>:ans;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> ll <span class="title">work</span><span class="params">(ll x)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		x%=mod; <span class="type">int</span> l=<span class="built_in">L</span>(x);</span><br><span class="line">		<span class="keyword">if</span>(l!=<span class="number">1</span>) <span class="keyword">return</span> l;</span><br><span class="line">		ll a=<span class="built_in">rand</span>()%mod;</span><br><span class="line">		<span class="keyword">for</span>(;<span class="built_in">L</span>(w=(a*a%mod-x+mod)%mod)!=<span class="number">-1</span>;a=<span class="built_in">rand</span>()%mod);</span><br><span class="line">		num y=(num)&#123;a,<span class="number">1</span>&#125;;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Pow</span>(y,(mod+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> CRT&#123;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">exCRT</span><span class="params">(<span class="type">int</span> n,ll *a,ll *m,ll &amp;A)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ll M;<span class="comment">//lcm</span></span><br><span class="line">        <span class="built_in">fo</span>(i,<span class="number">1</span>,n) a[i]=(a[i]%m[i]+m[i])%m[i];</span><br><span class="line">        A=a[<span class="number">1</span>],M=m[<span class="number">1</span>];</span><br><span class="line">        ll c,d,x,y,t;</span><br><span class="line">        <span class="built_in">fo</span>(i,<span class="number">2</span>,n)</span><br><span class="line">        &#123;</span><br><span class="line">            c=a[i]-A;</span><br><span class="line">            d=<span class="built_in">exgcd</span>(M,m[i],x,y);</span><br><span class="line">            <span class="keyword">if</span>(c%d!=<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            t=m[i]/d; x=<span class="built_in">mul</span>(x,c/d,t); x=(x%t+t)%t;</span><br><span class="line">            A=A+M*x; M=M/d*m[i]; A=(A+M)%M;</span><br><span class="line">        &#125;</span><br><span class="line">        A=(A+M<span class="number">-1</span>)%M+<span class="number">1</span>; <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> Pollard_Rho&#123;</span><br><span class="line">	<span class="type">const</span> __int128 ONE=<span class="number">1</span>;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> ll <span class="title">RandInt</span><span class="params">(ll l,ll r)</span> </span>&#123;</span><br><span class="line">		<span class="function"><span class="type">static</span> mt19937 <span class="title">rnd</span><span class="params">(time(<span class="number">0</span>))</span></span>;</span><br><span class="line">		<span class="function">uniform_int_distribution&lt;ll&gt; <span class="title">dis</span><span class="params">(l,r)</span></span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">dis</span>(rnd);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> ll <span class="title">Pow</span><span class="params">(ll x,ll y,ll mod)</span> </span>&#123;</span><br><span class="line">		ll ans=<span class="number">1</span>;<span class="keyword">for</span>(;y;y&gt;&gt;=<span class="number">1</span>,x=ONE*x*x%mod)<span class="keyword">if</span>(y&amp;<span class="number">1</span>) ans=ONE*ans*x%mod;</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Miller_Rabin</span><span class="params">(ll n)</span></span>&#123;</span><br><span class="line">		<span class="type">static</span> vector&lt;ll&gt; p = &#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">23</span>,<span class="number">29</span>,<span class="number">31</span>,<span class="number">37</span>&#125;;</span><br><span class="line">		<span class="keyword">if</span>(n&lt;<span class="number">3</span>||(!(n&amp;<span class="number">1ll</span>))) <span class="keyword">return</span> n==<span class="number">2ll</span>;</span><br><span class="line">		ll a=n<span class="number">-1</span>,b=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(;!(a&amp;<span class="number">1</span>);a&gt;&gt;=<span class="number">1</span>) b++;</span><br><span class="line">		<span class="keyword">auto</span> chk = [&amp;](<span class="type">const</span> ll &amp;x) &#123;</span><br><span class="line">			ll v = <span class="built_in">Pow</span>(x,a,n);</span><br><span class="line">			<span class="keyword">if</span>(v==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">			<span class="type">int</span> j=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">for</span>(;j&lt;=b;j++) &#123;</span><br><span class="line">				<span class="keyword">if</span>(v==n<span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">				v=ONE*v*v%n;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(j&gt;b) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(n&gt;<span class="number">37</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">auto</span> x:p) <span class="keyword">if</span>(!<span class="built_in">chk</span>(x)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">auto</span> x:p) <span class="keyword">if</span>(n==x) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">Pollard_Rho</span><span class="params">(ll n)</span> </span>&#123;</span><br><span class="line">		ll s=<span class="number">0</span>,t=<span class="number">0</span>,c=<span class="built_in">RandInt</span>(<span class="number">1</span>,n<span class="number">-1</span>),val=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">auto</span> f = [&amp;](<span class="type">const</span> ll &amp;x) &#123;<span class="built_in">return</span> (ONE*x*x+c)%n;&#125;;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> g=<span class="number">1</span>;;g&lt;&lt;=<span class="number">1</span>,s=t,val=<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> st=<span class="number">1</span>;st&lt;=g;st++) &#123;</span><br><span class="line">				t=<span class="built_in">f</span>(t);</span><br><span class="line">				val = (ONE*val*<span class="built_in">abs</span>(t-s))%n;</span><br><span class="line">				<span class="keyword">if</span>(st%<span class="number">127</span>==<span class="number">0</span>) &#123;</span><br><span class="line">					ll d = __gcd(val,n);</span><br><span class="line">					<span class="keyword">if</span>(d&gt;<span class="number">1</span>) <span class="keyword">return</span> d;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			ll d = __gcd(val,n);</span><br><span class="line">			<span class="keyword">if</span>(d&gt;<span class="number">1</span>) <span class="keyword">return</span> d;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	ll Ans;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Divide</span><span class="params">(ll n)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(n&lt;<span class="number">2</span>) <span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">Miller_Rabin</span>(n)) &#123;</span><br><span class="line">			Ans=<span class="built_in">max</span>(Ans,n);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		ll p = n;</span><br><span class="line">		<span class="keyword">for</span>(;p==n;) p = <span class="built_in">Pollard_Rho</span>(n);</span><br><span class="line">		<span class="built_in">Divide</span>(n/p); <span class="built_in">Divide</span>(p);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Powerful-Number"><a href="#Powerful-Number" class="headerlink" title="Powerful Number"></a>Powerful Number</h2><p>一个数 $n$ 满足 $\forall p((p\in \mathbb{P} \and p|n )\rightarrow p^2|n )$，则称 $n$ 为Powerful Number（简称PN）。</p>
<p>求出 $n$ 以内的PN数可以暴力搜索质因数。</p>
<p>假设我们要求 $\sum_{i&#x3D;1}^nf(i)$，构造两个函数 $g,h$ 使得：</p>
<ul>
<li>$g$ 是积性函数。且 $g$ 的前缀和 $S_g(n)$ 容易求出。</li>
<li>$\forall p\in \mathbb{P},g(p)&#x3D;f(p)$。</li>
<li>$f&#x3D;g * h$。</li>
</ul>
<p>那么，将原式变一变：</p>
<p>$$\sum_{i&#x3D;1}^n f(i)\&#x3D;\sum <em>{i&#x3D;1}^n\sum</em>{d|i}h(d)g(i&#x2F;d)\&#x3D;\sum_{i&#x3D;1}^nh(i)\sum_{j&#x3D;1}^{n&#x2F;i}g(j)\&#x3D;\sum_{i&#x3D;1}^n h(i)S_g(\left \lfloor \frac{n}{i} \right \rfloor)$$</p>
<p>可以发现 $f(p)&#x3D;g(1)h(p)+g(p)h(1)&#x3D;h(p)+g(p)$，又因为有 $g(p)&#x3D;f(p)$，因此 $h(p)&#x3D;0$。</p>
<p>显然 $h$ 是个积性函数，那么由积性函数的定义，对于 $h$ 的所有非 PN 数下标的取值均为 $0$。</p>
<p>我们只需快速求出所有 PN 数下标的 $h$ ，就可以了。</p>
<p>只需要求出 $h(p^k)$ 就可以了。这个可以通过推式子或者递推等解决。</p>
<h2 id="类欧几里得"><a href="#类欧几里得" class="headerlink" title="类欧几里得"></a>类欧几里得</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Ans</span>&#123;</span><br><span class="line">	ll f,g,h;</span><br><span class="line">	<span class="comment">// f = \sum_&#123;i=0&#125;^n (ai+b)/c</span></span><br><span class="line">	<span class="comment">// g = \sum_&#123;i=0&#125;^n [(ai+b)/c]^2</span></span><br><span class="line">	<span class="comment">// h = \sum_&#123;i=0&#125;^n i[(ai+b)/c]</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">Ans <span class="title">solve</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c,<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!a) <span class="keyword">return</span> &#123;</span><br><span class="line">		(ll)b/c*(n+<span class="number">1</span>)%mod,</span><br><span class="line">		(ll)<span class="built_in">Sqr</span>(b/c)*(n+<span class="number">1</span>)%mod,</span><br><span class="line">		(ll)b/c*n%mod*(n+<span class="number">1</span>)%mod*inv2%mod</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(a&gt;=c||b&gt;=c) &#123;</span><br><span class="line">		Ans d=<span class="built_in">solve</span>(a%c,b%c,c,n);</span><br><span class="line">		<span class="keyword">return</span> &#123;</span><br><span class="line">			((ll)a/c*n%mod*(n+<span class="number">1</span>)%mod*inv2+(ll)b/c*(n+<span class="number">1</span>)+d.f)%mod,</span><br><span class="line">			((ll)n*(n+<span class="number">1</span>)%mod*(n*<span class="number">2ll</span>+<span class="number">1</span>)%mod*inv6%mod*<span class="built_in">Sqr</span>(a/c)+</span><br><span class="line">				(ll)(n+<span class="number">1</span>)*<span class="built_in">Sqr</span>(b/c)+(ll)n*(n+<span class="number">1</span>)%mod*(a/c)%mod*(b/c)+</span><br><span class="line">				b/c*<span class="number">2ll</span>*d.f+a/c*<span class="number">2ll</span>%mod*d.h+d.g)%mod,</span><br><span class="line">			((ll)n*(n+<span class="number">1</span>)%mod*(n*<span class="number">2ll</span>+<span class="number">1</span>)%mod*inv6%mod*(a/c)+</span><br><span class="line">				(ll)n*(n+<span class="number">1</span>)%mod*inv2%mod*(b/c)+d.h)%mod</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="type">int</span> m=((ll)a*n+b)/c;</span><br><span class="line">		Ans d=<span class="built_in">solve</span>(c,c-b<span class="number">-1</span>,a,m<span class="number">-1</span>);</span><br><span class="line">		<span class="keyword">return</span> &#123;</span><br><span class="line">			((ll)n*m-d.f+mod)%mod,</span><br><span class="line">			((ll)n*m%mod*m%mod-d.f-d.h*<span class="number">2</span>+mod*<span class="number">3</span>)%mod,</span><br><span class="line">			((ll)n*m%mod*(n+<span class="number">1</span>)-d.g-d.f+mod+mod)%mod*inv2%mod</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="BSGS"><a href="#BSGS" class="headerlink" title="BSGS"></a>BSGS</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//y^x==z (mod p) −&gt;x=?</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bsgs</span><span class="params">(<span class="type">int</span> y,ll z,<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	y %= p, z %= p; j = z;</span><br><span class="line">	<span class="keyword">if</span>(y==<span class="number">0</span>)&#123;<span class="built_in">puts</span>(”Cannot␣find␣x”);<span class="keyword">continue</span>;&#125;</span><br><span class="line">	<span class="keyword">for</span>(k=s=<span class="number">1</span>;k*k&lt;=p;k++);</span><br><span class="line">	std::map&lt;<span class="type">int</span>,<span class="type">int</span>&gt;hash; flag=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;k;i++,s=<span class="number">1LL</span>*s*y%p,j=<span class="number">1LL</span>*j*y%p) hash[j]=i;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,j=s;i&lt;=k&amp;&amp;!flag;i++,j=<span class="number">1LL</span>*j*s%p)</span><br><span class="line">	<span class="keyword">if</span>(hash.<span class="built_in">count</span>(j)) ans=i*k−hash[j],flag=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(flag==<span class="number">0</span>) <span class="built_in">puts</span>(”Cannot find x”);</span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">printf</span>(”%d\n”,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//exBSGS</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bsgs</span><span class="params">(<span class="type">int</span> a,ll b,<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(a%=p,b%=p,b==<span class="number">1</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	ll t=<span class="number">1</span>;<span class="type">int</span> f,g,delta=<span class="number">0</span>,m=<span class="built_in">sqrt</span>(p)+<span class="number">1</span>,i;</span><br><span class="line">	<span class="keyword">for</span>(g=<span class="built_in">gcd</span>(a,p);g!=<span class="number">1</span>;g=<span class="built_in">gcd</span>(a,p))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(b%g)<span class="keyword">return</span> −<span class="number">1</span>;</span><br><span class="line">		b/=g,p/=g,t=t*(a/g)%p,delta++;</span><br><span class="line">		<span class="keyword">if</span>(b==t)<span class="keyword">return</span> delta;</span><br><span class="line">	&#125;</span><br><span class="line">	std::map&lt;<span class="type">int</span>,<span class="type">int</span>&gt;hash;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;m;i++,b=b*a%p)hash[b]=i;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">1</span>,f=<span class="built_in">power</span>(a,m);i&lt;=m+<span class="number">1</span>;i++)</span><br><span class="line">	<span class="keyword">if</span>(t=t*f%p,hash.<span class="built_in">count</span>(t))<span class="keyword">return</span> i*m−hash[t]+delta;</span><br><span class="line">	<span class="keyword">return</span> −<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="扩展Lucas"><a href="#扩展Lucas" class="headerlink" title="扩展Lucas"></a>扩展Lucas</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">Pow</span><span class="params">(ll x,ll y,ll mod)</span> </span>&#123;</span><br><span class="line">	ll ans=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(;y;y&gt;&gt;=<span class="number">1</span>,x=x*x%mod) <span class="keyword">if</span>(y&amp;<span class="number">1</span>) ans=ans*x%mod;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">gcd</span><span class="params">(ll x,ll y)</span></span>&#123;<span class="keyword">return</span> y?<span class="built_in">gcd</span>(y,x%y):x;&#125;</span><br><span class="line"><span class="function">ll <span class="title">exgcd</span><span class="params">(ll a,ll b,ll &amp;x,ll &amp;y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!b) &#123;</span><br><span class="line">		x=<span class="number">1</span>; y=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">return</span> a;</span><br><span class="line">	&#125;</span><br><span class="line">	ll d=<span class="built_in">exgcd</span>(b,a%b,y,x);</span><br><span class="line">	y-=a/b*x;</span><br><span class="line">	<span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">inv</span><span class="params">(ll a,ll b)</span> </span>&#123;</span><br><span class="line">	ll x,y,d;</span><br><span class="line">	d=<span class="built_in">exgcd</span>(a,b,x,y);</span><br><span class="line">	<span class="keyword">if</span>(d!=<span class="number">1</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">return</span> (x%b+b)%b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> pair&lt;ll,ll&gt; <span class="title">excrt</span><span class="params">(<span class="type">int</span> n,ll *c,ll *m)</span> </span>&#123;</span><br><span class="line">	ll nc=c[<span class="number">1</span>],nm=m[<span class="number">1</span>],d;</span><br><span class="line">	<span class="built_in">fo</span>(i,<span class="number">2</span>,n) &#123;</span><br><span class="line">		d=<span class="built_in">gcd</span>(m[i],nm);</span><br><span class="line">		<span class="keyword">if</span>((c[i]-nc)%d!=<span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">mp</span>(<span class="number">-1</span>,<span class="number">-1</span>);</span><br><span class="line">		nc=<span class="built_in">inv</span>(nm/d,m[i]/d)*((c[i]-nc)/d)*nm+nc;</span><br><span class="line">		nm=nm/d*m[i];</span><br><span class="line">		nc=(nc%nm+nm)%nm;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">mp</span>(nc,nm);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M=<span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">namespace</span> ExLucas&#123;</span><br><span class="line">	ll sum[M];</span><br><span class="line">	<span class="type">int</span> t,p;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> _p,<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">		p=_p; t=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,k) t=t*p;</span><br><span class="line">		sum[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,t) sum[i]=(sum[i<span class="number">-1</span>]*((i%p==<span class="number">0</span>)?<span class="number">1</span>:i))%t;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> nq,sq;</span><br><span class="line">	<span class="function">ll <span class="title">fac</span><span class="params">(ll n)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!n) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		nq+=n/p;</span><br><span class="line">		<span class="keyword">if</span>(sum[t]==<span class="number">1</span>||(n/t)%<span class="number">2</span>==<span class="number">0</span>) <span class="keyword">return</span> sum[n%t]*<span class="built_in">fac</span>(n/p)%t;</span><br><span class="line">		<span class="keyword">return</span> (t-sum[n%t]%t*<span class="built_in">fac</span>(n/p)%t)%t;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> ll <span class="title">C</span><span class="params">(ll n,ll m,<span class="type">int</span> p,<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">		<span class="built_in">init</span>(p,k); sq=<span class="number">0</span>;</span><br><span class="line">		ll ans,sum;</span><br><span class="line">		nq=<span class="number">0</span>; ans=<span class="built_in">fac</span>(n); sq+=nq;</span><br><span class="line">		nq=<span class="number">0</span>; sum=<span class="built_in">fac</span>(m); sq-=nq;</span><br><span class="line">		nq=<span class="number">0</span>; sum=sum*<span class="built_in">fac</span>(n-m)%t; sq-=nq;</span><br><span class="line">		<span class="keyword">return</span> ans*<span class="built_in">inv</span>(sum,t)%t*<span class="built_in">Pow</span>(p,sq,t)%t;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">ll n,m,mod,q,c[<span class="number">100</span>],mo[<span class="number">100</span>];</span><br><span class="line"><span class="type">int</span> top;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	cin&gt;&gt;n&gt;&gt;m&gt;&gt;mod; q=mod;</span><br><span class="line">	<span class="type">int</span> t;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i*i&lt;=q;i++)</span><br><span class="line">		<span class="keyword">if</span>(q%i==<span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span>(t=<span class="number">0</span>;q%i==<span class="number">0</span>;q/=i) t++;</span><br><span class="line">			++top;</span><br><span class="line">			c[top]=ExLucas::<span class="built_in">C</span>(n,m,i,t);</span><br><span class="line">			mo[top]=ExLucas::t;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">if</span>(q!=<span class="number">1</span>) &#123;</span><br><span class="line">		c[++top]=ExLucas::<span class="built_in">C</span>(n,m,q,<span class="number">1</span>);</span><br><span class="line">		mo[top]=ExLucas::t;</span><br><span class="line">	&#125;</span><br><span class="line">	pair&lt;ll,ll&gt; ans=<span class="built_in">excrt</span>(top,c,mo);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,ans.fi);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Min25筛"><a href="#Min25筛" class="headerlink" title="Min25筛"></a>Min25筛</h2><p>前提：积性函数；表示为 $\sum_{i\in \mathbb{P}}i^k$ 或 直接算；$f(p^k)$ 快速算。</p>
<p>$g(n,j)&#x3D;\sum_{i&#x3D;1}^{n}[i\in \mathbb{P} \text{ or }\min_i(p)&gt; P_j]$</p>
<p>$$<br>g(n,j)&#x3D;\begin{cases}<br>    g(n,j-1) &amp; \text{ if } P_j^2&gt;n \newline<br>    g(n,j-1)-P_j^k\left ( g(\left \lfloor \frac{n}{P_j} \right \rfloor,j-1)-g(P_{j-1},j-1) \right ) &amp; \text{ otherwise }<br>\end{cases}<br>$$</p>
<p>$\sum_{i&#x3D;1}^n[i\in \mathbb{P}]i^k&#x3D;g(n,\pi( \left \lfloor  \sqrt n\right \rfloor))$。</p>
<p>$$S(n,j)&#x3D;\left ( g(n,\pi( \left \lfloor  \sqrt n\right \rfloor)) \right )-g(P_{j-1},j-1))+ \sum_{k&#x3D;j}^{\sqrt n}\sum_{P_k^{q+1}\leq n}(f(P_k^q)S(\left \lfloor \frac{n}{P_k^q} \right \rfloor,k+1)+f(P_{k}^{q+1}))$$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1000000</span>;</span><br><span class="line">ll n,m,Sqr,pri[N],sp[N],id1[N],id2[N],w[N];</span><br><span class="line">ll h[N],g[N];</span><br><span class="line"><span class="type">bool</span> vis[N];<span class="type">int</span> tot;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init_prime</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    vis[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[i]) &#123;pri[++tot]=i; sp[tot]=(sp[tot<span class="number">-1</span>]+i)%mod;&#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=tot&amp;&amp;<span class="number">1ll</span>*i*pri[j]&lt;=n;j++) &#123;</span><br><span class="line">            vis[i*pri[j]]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%pri[j]==<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(ll n,<span class="type">int</span> j)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;=<span class="number">1</span>||pri[j]&gt;n) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    ll t=(n&lt;=Sqr)?id1[n]:id2[::n/n];</span><br><span class="line">    ll ans=(mod+(g[t]-sp[j<span class="number">-1</span>])-(h[t]-(j<span class="number">-1</span>))%mod)%mod;</span><br><span class="line">    <span class="keyword">if</span>(j==<span class="number">1</span>) ans+=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k=j;k&lt;=tot&amp;&amp;pri[k]*pri[k]&lt;=n;k++) &#123;</span><br><span class="line">        ll tmp=pri[k];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> q=<span class="number">1</span>;tmp*pri[k]&lt;=n;q++,tmp*=pri[k])</span><br><span class="line">            ans=<span class="built_in">Add</span>(ans,<span class="built_in">Add</span>(pri[k]^(q+<span class="number">1</span>),<span class="built_in">Mul</span>(pri[k]^q,<span class="built_in">S</span>(n/tmp,k+<span class="number">1</span>))));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;n); Sqr=<span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="built_in">init_prime</span>(Sqr);</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>,j;i&lt;=n;i=j+<span class="number">1</span>) &#123;</span><br><span class="line">        j=n/(n/i); w[++m]=n/i;</span><br><span class="line">        h[m]=(w[m]<span class="number">-1</span>)%mod;</span><br><span class="line">        g[m]=(w[m]%mod)*((w[m]+<span class="number">1</span>)%mod)%mod*inv2%mod<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>(w[m]&lt;=Sqr) id1[w[m]]=m;</span><br><span class="line">        <span class="keyword">else</span> id2[j]=m;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot;i++) &#123;</span><br><span class="line">        ll k=pri[i]*pri[i];<span class="comment">//可用long double 优化</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m&amp;&amp;k&lt;=w[j];j++) &#123;</span><br><span class="line">            <span class="type">int</span> t=(w[j]/pri[i]&lt;=Sqr)?id1[w[j]/pri[i]]:id2[n/(w[j]/pri[i])];</span><br><span class="line">            h[j]=<span class="built_in">Add</span>(h[j],(mod-(h[t]-(i<span class="number">-1</span>)%mod))%mod);</span><br><span class="line">            g[j]=<span class="built_in">Add</span>(g[j],mod<span class="number">-1ll</span>*pri[i]*(g[t]-sp[i<span class="number">-1</span>]+mod)%mod);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,(<span class="built_in">S</span>(n,<span class="number">1</span>)+<span class="number">1</span>)%mod);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="多项式"><a href="#多项式" class="headerlink" title="多项式"></a>多项式</h2><h3 id="FWT"><a href="#FWT" class="headerlink" title="FWT"></a>FWT</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">FWT_or</span><span class="params">(<span class="type">int</span> *a,<span class="type">int</span> opt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;N;i&lt;&lt;=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> p=i&lt;&lt;<span class="number">1</span>,j=<span class="number">0</span>;j&lt;N;j+=p)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;i;++k)</span><br><span class="line">                <span class="keyword">if</span>(opt==<span class="number">1</span>)a[i+j+k]=(a[j+k]+a[i+j+k])%MOD;</span><br><span class="line">                <span class="keyword">else</span> a[i+j+k]=(a[i+j+k]+MOD-a[j+k])%MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FWT_and</span><span class="params">(<span class="type">int</span> *a,<span class="type">int</span> opt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;N;i&lt;&lt;=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> p=i&lt;&lt;<span class="number">1</span>,j=<span class="number">0</span>;j&lt;N;j+=p)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;i;++k)</span><br><span class="line">                <span class="keyword">if</span>(opt==<span class="number">1</span>)a[j+k]=(a[j+k]+a[i+j+k])%MOD;</span><br><span class="line">                <span class="keyword">else</span> a[j+k]=(a[j+k]+MOD-a[i+j+k])%MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FWT_xor</span><span class="params">(<span class="type">int</span> *a,<span class="type">int</span> opt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;N;i&lt;&lt;=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> p=i&lt;&lt;<span class="number">1</span>,j=<span class="number">0</span>;j&lt;N;j+=p)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;i;++k)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> X=a[j+k],Y=a[i+j+k];</span><br><span class="line">                a[j+k]=(X+Y)%MOD;a[i+j+k]=(X+MOD-Y)%MOD;</span><br><span class="line">                <span class="keyword">if</span>(opt==<span class="number">-1</span>)a[j+k]=<span class="number">1ll</span>*a[j+k]*inv2%MOD,a[i+j+k]=<span class="number">1ll</span>*a[i+j+k]*inv2%MOD;</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="FFT"><a href="#FFT" class="headerlink" title="FFT"></a>FFT</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Com</span>&#123;</span><br><span class="line">	db x,y;</span><br><span class="line">	<span class="built_in">Com</span>(db _x=<span class="number">0</span>,db _y=<span class="number">0</span>) &#123;x=_x,y=_y;&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">inline</span> Com <span class="keyword">operator</span> + (<span class="type">const</span> Com &amp;A,<span class="type">const</span> Com &amp;B)</span><br><span class="line">	&#123;<span class="keyword">return</span> <span class="built_in">Com</span>(A.x+B.x,A.y+B.y);&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">inline</span> Com <span class="keyword">operator</span> - (<span class="type">const</span> Com &amp;A,<span class="type">const</span> Com &amp;B)</span><br><span class="line">	&#123;<span class="keyword">return</span> <span class="built_in">Com</span>(A.x-B.x,A.y-B.y);&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">inline</span> Com <span class="keyword">operator</span> * (<span class="type">const</span> Com &amp;A,<span class="type">const</span> Com &amp;B)</span><br><span class="line">	&#123;<span class="keyword">return</span> <span class="built_in">Com</span>(A.x*B.x-A.y*B.y,A.x*B.y+B.x*A.y);&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M=<span class="number">1</span>&lt;&lt;<span class="number">21</span>;</span><br><span class="line"><span class="keyword">namespace</span> Poly&#123;</span><br><span class="line">	<span class="type">const</span> db pi=<span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line">	<span class="type">int</span> R[M]; Com W[M];</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">fft</span><span class="params">(Com *a,<span class="type">int</span> n,<span class="type">int</span> opt)</span> </span>&#123;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">			R[i]=(R[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>)|((i&amp;<span class="number">1</span>)*(n&gt;&gt;<span class="number">1</span>));</span><br><span class="line">			<span class="keyword">if</span>(i&lt;R[i]) <span class="built_in">swap</span>(a[i],a[R[i]]);</span><br><span class="line">		&#125;</span><br><span class="line">		Com w;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i&lt;&lt;=<span class="number">1</span>)</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;n;j+=(i&lt;&lt;<span class="number">1</span>))</span><br><span class="line">				<span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;i;k++)</span><br><span class="line">					w=W[i+k]*a[i+j+k],</span><br><span class="line">					a[i+j+k]=a[j+k]-w,</span><br><span class="line">					a[j+k]=a[j+k]+w;</span><br><span class="line">		<span class="keyword">if</span>(opt!=<span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line">			<span class="built_in">reverse</span>(a+<span class="number">1</span>,a+n);</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) a[i].x/=n;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;M;i&lt;&lt;=<span class="number">1</span>)</span><br><span class="line">			<span class="built_in">fo</span>(j,<span class="number">0</span>,i<span class="number">-1</span>)</span><br><span class="line">				W[i+j]=<span class="built_in">Com</span>(<span class="built_in">cos</span>(pi*j/i),<span class="built_in">sin</span>(pi*j/i));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="拆系数FFT"><a href="#拆系数FFT" class="headerlink" title="拆系数FFT"></a>拆系数FFT</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> ll mo=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line">db pi=<span class="built_in">acos</span>(<span class="number">-1.</span>);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">P</span>&#123;</span><br><span class="line">    db x,y;</span><br><span class="line">    <span class="built_in">P</span>(db _x=<span class="number">0</span>,db _y=<span class="number">0</span>) &#123;x=_x,y=_y;&#125;</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">inline</span> P <span class="keyword">operator</span> +(<span class="type">const</span> P&amp;A,<span class="type">const</span> P&amp;B)&#123;<span class="keyword">return</span> (P)&#123;A.x+B.x,A.y+B.y&#125;;&#125;</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">inline</span> P <span class="keyword">operator</span> -(<span class="type">const</span> P&amp;A,<span class="type">const</span> P&amp;B)&#123;<span class="keyword">return</span> (P)&#123;A.x-B.x,A.y-B.y&#125;;&#125;</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">inline</span> P <span class="keyword">operator</span> *(<span class="type">const</span> P&amp;A,<span class="type">const</span> P&amp;B)&#123;<span class="keyword">return</span> (P)&#123;A.x*B.x-A.y*B.y,A.x*B.y+A.y*B.x&#125;;&#125;</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">inline</span> P <span class="keyword">operator</span> /(<span class="type">const</span> P&amp;A,<span class="type">const</span> db &amp;x)&#123;<span class="keyword">return</span> (P)&#123;A.x/x,A.y/x&#125;;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function">P <span class="title">conj</span><span class="params">(P A)</span> </span>&#123;<span class="keyword">return</span> (P)&#123;A.x,-A.y&#125;;&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M=<span class="number">1</span>&lt;&lt;<span class="number">20</span>;</span><br><span class="line">P W[M]; <span class="type">int</span> R[M];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">PolyInit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;M;i&lt;&lt;=<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">fo</span>(j,<span class="number">0</span>,i<span class="number">-1</span>)</span><br><span class="line">            W[i+j]=(P)&#123;<span class="built_in">cos</span>(pi*j/i),<span class="built_in">sin</span>(pi*j/i)&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">typedef</span> vector&lt;P&gt; Poly;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ntt</span><span class="params">(P *a,<span class="type">int</span> n,<span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">        R[i]=(R[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>)|((i&amp;<span class="number">1</span>)*(n&gt;&gt;<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">if</span>(i&lt;R[i]) <span class="built_in">swap</span>(a[i],a[R[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    P w;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i&lt;&lt;=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;n;j+=(i&lt;&lt;<span class="number">1</span>))</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;i;k++)</span><br><span class="line">                w=W[i+k]*a[i+j+k],</span><br><span class="line">                a[i+j+k]=a[j+k]-w,</span><br><span class="line">                a[j+k]=a[j+k]+w;</span><br><span class="line">    <span class="keyword">if</span>(t==<span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">reverse</span>(a+<span class="number">1</span>,a+n);</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) a[i]=a[i]/n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ntt</span><span class="params">(Poly &amp;A,<span class="type">int</span> n,<span class="type">int</span> t)</span></span>&#123;<span class="built_in">ntt</span>(&amp;A[<span class="number">0</span>],n,t);&#125;</span><br><span class="line"><span class="keyword">inline</span> Poly <span class="keyword">operator</span> +(Poly A,Poly B) &#123;</span><br><span class="line">    A.<span class="built_in">resize</span>(<span class="built_in">max</span>(A.<span class="built_in">size</span>(),B.<span class="built_in">size</span>()));</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">0</span>,B.<span class="built_in">size</span>()<span class="number">-1</span>) A[i]=A[i]+B[i];</span><br><span class="line">    <span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Real(A) ((ll)floor(A.x+0.5))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Imag(A) ((ll)floor(A.y+0.5))</span></span><br><span class="line"><span class="keyword">inline</span> Poly <span class="keyword">operator</span> *(Poly A,Poly B) &#123;</span><br><span class="line">    <span class="type">static</span> Poly C,D;</span><br><span class="line">    <span class="type">int</span> n=A.<span class="built_in">size</span>(),m=B.<span class="built_in">size</span>(),k=n+m<span class="number">-1</span>,len=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(;len&lt;k;len&lt;&lt;=<span class="number">1</span>);</span><br><span class="line">    C.<span class="built_in">resize</span>(len); D.<span class="built_in">resize</span>(len); A.<span class="built_in">resize</span>(len); B.<span class="built_in">resize</span>(len);</span><br><span class="line">    <span class="built_in">ff</span>(i,<span class="number">0</span>,len) C[i]=(P)&#123;<span class="built_in">Real</span>(A[i])&amp;<span class="number">32767</span>,<span class="built_in">Real</span>(A[i])&gt;&gt;<span class="number">15</span>&#125;,D[i]=(P)&#123;<span class="built_in">Real</span>(B[i])&amp;<span class="number">32767</span>,<span class="built_in">Real</span>(B[i])&gt;&gt;<span class="number">15</span>&#125;;</span><br><span class="line">    <span class="built_in">ntt</span>(C,len,<span class="number">1</span>); <span class="built_in">ntt</span>(D,len,<span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> j;</span><br><span class="line">    <span class="built_in">ff</span>(i,<span class="number">0</span>,len) &#123;</span><br><span class="line">        P d4,d0,d1,d2,d3;</span><br><span class="line">        j=(len-i)&amp;(len<span class="number">-1</span>);</span><br><span class="line">        d4=<span class="built_in">conj</span>(C[j]); d0=(d4+C[i])*<span class="built_in">P</span>(<span class="number">0.5</span>,<span class="number">0</span>); d1=(d4-C[i])*<span class="built_in">P</span>(<span class="number">0</span>,<span class="number">0.5</span>);</span><br><span class="line">        d4=<span class="built_in">conj</span>(D[j]);  d2=(d4+D[i])*<span class="built_in">P</span>(<span class="number">0.5</span>,<span class="number">0</span>); d3=(d4-D[i])*<span class="built_in">P</span>(<span class="number">0</span>,<span class="number">0.5</span>);</span><br><span class="line">        A[i]=d0*d2+d1*d3*<span class="built_in">P</span>(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">        B[i]=d0*d3+d1*d2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">ntt</span>(A,len,<span class="number">-1</span>); <span class="built_in">ntt</span>(B,len,<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">ff</span>(i,<span class="number">0</span>,len) C[i]=(<span class="built_in">Real</span>(A[i]) + (<span class="built_in">Imag</span>(A[i]) % mo &lt;&lt; <span class="number">30</span>) + (<span class="built_in">Real</span>(B[i]) % mo &lt;&lt; <span class="number">15</span>))%mo;</span><br><span class="line">    C.<span class="built_in">resize</span>(k); <span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="NTT"><a href="#NTT" class="headerlink" title="NTT"></a>NTT</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> ll mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M=<span class="number">1</span>&lt;&lt;<span class="number">20</span>;</span><br><span class="line">ll W[M]; <span class="type">int</span> R[M];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">PolyInit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ll w;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;M;i&lt;&lt;=<span class="number">1</span>) &#123;</span><br><span class="line">        W[i]=<span class="number">1</span>; w=<span class="built_in">Pow</span>(<span class="number">3</span>,(mod<span class="number">-1</span>)/<span class="number">2</span>/i);</span><br><span class="line">        <span class="built_in">fo</span>(j,<span class="number">1</span>,i<span class="number">-1</span>) W[i+j]=W[i+j<span class="number">-1</span>]*w%mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">typedef</span> vector&lt;ll&gt; Poly;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ntt</span><span class="params">(ll *a,<span class="type">int</span> n,<span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">        R[i]=(R[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>)|((i&amp;<span class="number">1</span>)*(n&gt;&gt;<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">if</span>(i&lt;R[i]) <span class="built_in">swap</span>(a[i],a[R[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    ll w;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i&lt;&lt;=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;n;j+=(i&lt;&lt;<span class="number">1</span>))</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;i;k++)</span><br><span class="line">                w=W[i+k]*a[i+j+k]%mod,</span><br><span class="line">                a[i+j+k]=<span class="built_in">Dec</span>(a[j+k],w),</span><br><span class="line">                a[j+k]=<span class="built_in">Add</span>(a[j+k],w);</span><br><span class="line">    <span class="keyword">if</span>(t==<span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">reverse</span>(a+<span class="number">1</span>,a+n);</span><br><span class="line">    w=<span class="built_in">Pow</span>(n,mod<span class="number">-2</span>);</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) a[i]=w*a[i]%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ntt</span><span class="params">(Poly &amp;A,<span class="type">int</span> n,<span class="type">int</span> t)</span></span>&#123;<span class="built_in">ntt</span>(&amp;A[<span class="number">0</span>],n,t);&#125;</span><br><span class="line"><span class="keyword">inline</span> Poly <span class="keyword">operator</span> +(Poly A,Poly B) &#123;</span><br><span class="line">    A.<span class="built_in">resize</span>(<span class="built_in">max</span>(A.<span class="built_in">size</span>(),B.<span class="built_in">size</span>()));</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">0</span>,B.<span class="built_in">size</span>()<span class="number">-1</span>) A[i]=<span class="built_in">Add</span>(A[i],B[i]);</span><br><span class="line">    <span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">inline</span> Poly <span class="keyword">operator</span> -(Poly A,Poly B) &#123;</span><br><span class="line">    A.<span class="built_in">resize</span>(<span class="built_in">max</span>(A.<span class="built_in">size</span>(),B.<span class="built_in">size</span>()));</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">0</span>,B.<span class="built_in">size</span>()<span class="number">-1</span>) A[i]=<span class="built_in">Dec</span>(A[i],B[i]);</span><br><span class="line">    <span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Poly <span class="title">df</span><span class="params">(Poly A)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">1</span>,A.<span class="built_in">size</span>()<span class="number">-1</span>) A[i<span class="number">-1</span>]=A[i]*i%mod;</span><br><span class="line">    A.<span class="built_in">resize</span>(A.<span class="built_in">size</span>()<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Poly <span class="title">jf</span><span class="params">(Poly A)</span> </span>&#123;</span><br><span class="line">    A.<span class="built_in">pb</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">fd</span>(i,A.<span class="built_in">size</span>()<span class="number">-1</span>,<span class="number">1</span>) A[i]=A[i<span class="number">-1</span>]*<span class="built_in">Pow</span>(i,mod<span class="number">-2</span>)%mod;</span><br><span class="line">    A[<span class="number">0</span>]=<span class="number">0</span>; <span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">inline</span> Poly <span class="keyword">operator</span> *(Poly A,ll k) &#123;</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">0</span>,A.<span class="built_in">size</span>()<span class="number">-1</span>) A[i]=<span class="built_in">Mul</span>(A[i],k);</span><br><span class="line">    <span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">inline</span> Poly <span class="keyword">operator</span> *(Poly A,Poly B) &#123;</span><br><span class="line">    <span class="type">int</span> n=A.<span class="built_in">size</span>(),m=B.<span class="built_in">size</span>(),k=n+m<span class="number">-1</span>,len=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(;len&lt;k;len&lt;&lt;=<span class="number">1</span>);</span><br><span class="line">    A.<span class="built_in">resize</span>(len); <span class="built_in">ntt</span>(A,len,<span class="number">1</span>);</span><br><span class="line">    B.<span class="built_in">resize</span>(len); <span class="built_in">ntt</span>(B,len,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">0</span>,len<span class="number">-1</span>) A[i]=A[i]*B[i]%mod;</span><br><span class="line">    <span class="built_in">ntt</span>(A,len,<span class="number">-1</span>);</span><br><span class="line">    A.<span class="built_in">resize</span>(k);</span><br><span class="line">    <span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">inline</span> Poly <span class="keyword">operator</span> ~(Poly f) &#123;</span><br><span class="line">    <span class="type">int</span> n=f.<span class="built_in">size</span>();</span><br><span class="line">    Poly g,h;</span><br><span class="line">    g.<span class="built_in">pb</span>(<span class="built_in">Pow</span>(f[<span class="number">0</span>],mod<span class="number">-2</span>));</span><br><span class="line">    <span class="type">int</span> m=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span>(;m&lt;n;m&lt;&lt;=<span class="number">1</span>) &#123;</span><br><span class="line">        h.<span class="built_in">resize</span>(m&lt;&lt;<span class="number">1</span>); g.<span class="built_in">resize</span>(m&lt;&lt;<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">fo</span>(i,<span class="number">0</span>,m<span class="number">-1</span>) h[i]=f[i];</span><br><span class="line">        <span class="built_in">ntt</span>(h,m&lt;&lt;<span class="number">1</span>,<span class="number">1</span>); <span class="built_in">ntt</span>(g,m&lt;&lt;<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">fo</span>(i,<span class="number">0</span>,(m&lt;&lt;<span class="number">1</span>)<span class="number">-1</span>) g[i]=<span class="built_in">Mul</span>(<span class="number">2</span>+mod-<span class="built_in">Mul</span>(g[i],h[i]),g[i]);</span><br><span class="line">        <span class="built_in">ntt</span>(g,m&lt;&lt;<span class="number">1</span>,<span class="number">-1</span>); g.<span class="built_in">resize</span>(m);</span><br><span class="line">    &#125;</span><br><span class="line">    g.<span class="built_in">resize</span>(m&lt;&lt;<span class="number">1</span>); f.<span class="built_in">resize</span>(m&lt;&lt;<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(f,m&lt;&lt;<span class="number">1</span>,<span class="number">1</span>); <span class="built_in">ntt</span>(g,m&lt;&lt;<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">0</span>,(m&lt;&lt;<span class="number">1</span>)<span class="number">-1</span>) g[i]=<span class="built_in">Mul</span>(<span class="number">2</span>+mod-<span class="built_in">Mul</span>(g[i],f[i]),g[i]);</span><br><span class="line">    <span class="built_in">ntt</span>(g,m&lt;&lt;<span class="number">1</span>,<span class="number">-1</span>); g.<span class="built_in">resize</span>(n);</span><br><span class="line">    <span class="keyword">return</span> g;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Poly <span class="title">Ln</span><span class="params">(Poly A)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> n=A.<span class="built_in">size</span>();</span><br><span class="line">	A=<span class="built_in">jf</span>((~A)*<span class="built_in">df</span>(A));</span><br><span class="line">	A.<span class="built_in">resize</span>(n); <span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Poly <span class="title">Exp</span><span class="params">(<span class="type">const</span> Poly &amp;A)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> n=<span class="number">1</span>; <span class="keyword">for</span>(;n&lt;A.<span class="built_in">size</span>();n&lt;&lt;=<span class="number">1</span>);</span><br><span class="line">	Poly B,C,D; B.<span class="built_in">clear</span>(); B.<span class="built_in">pb</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> m=<span class="number">2</span>;m&lt;=n;m&lt;&lt;=<span class="number">1</span>) &#123;</span><br><span class="line">		C=B; C.<span class="built_in">resize</span>(m); D=A; D.<span class="built_in">resize</span>(m);</span><br><span class="line">		C=D-<span class="built_in">Ln</span>(C); C[<span class="number">0</span>]=<span class="built_in">Add</span>(C[<span class="number">0</span>],<span class="number">1</span>);</span><br><span class="line">		B=B*C; B.<span class="built_in">resize</span>(m);</span><br><span class="line">	&#125;</span><br><span class="line">	B.<span class="built_in">resize</span>(A.<span class="built_in">size</span>()); <span class="keyword">return</span> B;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">inline</span> Poly <span class="keyword">operator</span> ^(Poly A,ll k) &#123;</span><br><span class="line">	<span class="keyword">if</span>(!A.<span class="built_in">size</span>()) <span class="keyword">return</span> A;</span><br><span class="line">	ll tmp=A[<span class="number">0</span>],w=<span class="built_in">Pow</span>(tmp,k);</span><br><span class="line">	tmp=<span class="built_in">Pow</span>(tmp,mod<span class="number">-2</span>);</span><br><span class="line">	<span class="built_in">fo</span>(i,<span class="number">0</span>,A.<span class="built_in">size</span>()<span class="number">-1</span>) A[i]=A[i]*tmp%mod;</span><br><span class="line">	A=<span class="built_in">Exp</span>(<span class="built_in">Ln</span>(A)*k);</span><br><span class="line">	<span class="built_in">fo</span>(i,<span class="number">0</span>,A.<span class="built_in">size</span>()<span class="number">-1</span>) A[i]=A[i]*w%mod;</span><br><span class="line">	<span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Poly <span class="title">Cos</span><span class="params">(Poly A)</span> </span>&#123;</span><br><span class="line">	<span class="type">static</span> ll w4=<span class="built_in">Pow</span>(<span class="number">3</span>,(mod<span class="number">-1</span>)/<span class="number">4</span>);</span><br><span class="line">	<span class="keyword">return</span> (<span class="built_in">Exp</span>(A*w4)+<span class="built_in">Exp</span>(A*(mod-w4)))*((mod+<span class="number">1</span>)/<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Poly <span class="title">Sin</span><span class="params">(Poly A)</span> </span>&#123;</span><br><span class="line">	<span class="type">static</span> ll w4=<span class="built_in">Pow</span>(<span class="number">3</span>,(mod<span class="number">-1</span>)/<span class="number">4</span>);</span><br><span class="line">	<span class="keyword">return</span> (<span class="built_in">Exp</span>(A*w4)-<span class="built_in">Exp</span>(A*(mod-w4)))*(<span class="built_in">Pow</span>(w4,mod<span class="number">-2</span>)*((mod+<span class="number">1</span>)/<span class="number">2</span>)%mod);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Poly <span class="title">Sqrt</span><span class="params">(Poly A)</span> </span>&#123;</span><br><span class="line">	Poly C,D,<span class="built_in">B</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">	C.<span class="built_in">clear</span>(); D.<span class="built_in">clear</span>();</span><br><span class="line">	<span class="type">int</span> n=A.<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">4</span>;(l&gt;&gt;<span class="number">2</span>)&lt;n;l&lt;&lt;=<span class="number">1</span>) &#123;</span><br><span class="line">		C=A; C.<span class="built_in">resize</span>(l&gt;&gt;<span class="number">1</span>);</span><br><span class="line">		D=B; D.<span class="built_in">resize</span>(l&gt;&gt;<span class="number">1</span>); D=(~D);</span><br><span class="line">		C.<span class="built_in">resize</span>(l); D.<span class="built_in">resize</span>(l);</span><br><span class="line">		<span class="built_in">ntt</span>(C,l,<span class="number">1</span>); <span class="built_in">ntt</span>(D,l,<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">ff</span>(i,<span class="number">0</span>,l) C[i]=C[i]*D[i]%mod;</span><br><span class="line">		<span class="built_in">ntt</span>(C,l,<span class="number">-1</span>);</span><br><span class="line">		B.<span class="built_in">resize</span>(l&gt;&gt;<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">ff</span>(i,<span class="number">0</span>,(l&gt;&gt;<span class="number">1</span>)) B[i]=<span class="built_in">Add</span>(C[i],B[i])*((mod+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>)%mod;</span><br><span class="line">	&#125;</span><br><span class="line">	B.<span class="built_in">resize</span>(n);</span><br><span class="line">	<span class="keyword">return</span> B;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">inline</span> Poly <span class="keyword">operator</span>/(Poly A,Poly B) &#123;</span><br><span class="line">	<span class="type">int</span> len=<span class="number">1</span>,deg=A.<span class="built_in">size</span>()-B.<span class="built_in">size</span>()+<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">reverse</span>(<span class="built_in">all</span>(A)); <span class="built_in">reverse</span>(<span class="built_in">all</span>(B));</span><br><span class="line">	<span class="keyword">for</span>(;len&lt;=deg;len&lt;&lt;=<span class="number">1</span>);</span><br><span class="line">	B.<span class="built_in">resize</span>(len); B=~B; B.<span class="built_in">resize</span>(deg);</span><br><span class="line">	A=A*B; A.<span class="built_in">resize</span>(deg);</span><br><span class="line">	<span class="built_in">reverse</span>(<span class="built_in">all</span>(A));</span><br><span class="line">	<span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">inline</span> Poly <span class="keyword">operator</span>%(<span class="type">const</span> Poly &amp;A,<span class="type">const</span> Poly &amp;B) &#123;</span><br><span class="line">	<span class="keyword">if</span>(A.<span class="built_in">size</span>()&lt;B.<span class="built_in">size</span>()) <span class="keyword">return</span> A;</span><br><span class="line">	Poly C=A-(A/B)*B;</span><br><span class="line">	C.<span class="built_in">resize</span>(B.<span class="built_in">size</span>()<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Poly <span class="title">Pow</span><span class="params">(Poly A,ll n,Poly M)</span> </span>&#123;</span><br><span class="line">	Poly B=A; n--;</span><br><span class="line">	<span class="keyword">for</span>(;n;n&gt;&gt;=<span class="number">1</span>,A=(A*A)%M) <span class="keyword">if</span>(n&amp;<span class="number">1ll</span>) B=(B*A)%M;</span><br><span class="line">	<span class="keyword">return</span> B;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">64005</span>*<span class="number">4</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lc (u&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rc ((u&lt;&lt;1)|1)</span></span><br><span class="line">Poly P[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">ll ans[N],a[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Poly <span class="title">MulT</span><span class="params">(Poly A,Poly B)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> n=A.<span class="built_in">size</span>(),m=B.<span class="built_in">size</span>();</span><br><span class="line">	<span class="built_in">reverse</span>(<span class="built_in">all</span>(B));</span><br><span class="line">	<span class="type">int</span> len=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(;len&lt;n;len&lt;&lt;=<span class="number">1</span>);</span><br><span class="line">	A.<span class="built_in">resize</span>(len); B.<span class="built_in">resize</span>(len);</span><br><span class="line">	<span class="built_in">ntt</span>(A,len,<span class="number">1</span>); <span class="built_in">ntt</span>(B,len,<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">ff</span>(i,<span class="number">0</span>,len) A[i]=A[i]*B[i]%mod;</span><br><span class="line">	<span class="built_in">ntt</span>(A,len,<span class="number">-1</span>);</span><br><span class="line">	B.<span class="built_in">clear</span>();</span><br><span class="line">	len--;</span><br><span class="line">	<span class="built_in">fo</span>(i,m<span class="number">-1</span>,n+m<span class="number">-2</span>) B.<span class="built_in">pb</span>(A[i&amp;len]);</span><br><span class="line">	<span class="keyword">return</span> B;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l==r) &#123;</span><br><span class="line">		P[u].<span class="built_in">pb</span>(<span class="number">1</span>); P[u].<span class="built_in">pb</span>(<span class="built_in">Dec</span>(<span class="number">0</span>,a[l]));<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">solve</span>(lc,l,mid); <span class="built_in">solve</span>(rc,mid+<span class="number">1</span>,r);</span><br><span class="line">	P[u]=P[lc]*P[rc];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r,Poly A)</span> </span>&#123;</span><br><span class="line">	A.<span class="built_in">resize</span>(r-l+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">if</span>(l==r) <span class="keyword">return</span> (<span class="type">void</span>)(ans[l]=A[<span class="number">0</span>]);</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">solve</span>(lc,l,mid,<span class="built_in">MulT</span>(A,P[rc])); <span class="built_in">solve</span>(rc,mid+<span class="number">1</span>,r,<span class="built_in">MulT</span>(A,P[lc]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,m,k;</span><br><span class="line">Poly F,G;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">PolyInit</span>();</span><br><span class="line">	n=<span class="built_in">read</span>(); m=<span class="built_in">read</span>(); k=<span class="built_in">max</span>(n,m);</span><br><span class="line">	<span class="built_in">fo</span>(i,<span class="number">0</span>,n) F.<span class="built_in">pb</span>(<span class="built_in">read</span>());</span><br><span class="line">	F.<span class="built_in">resize</span>(n+k+<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">fo</span>(i,<span class="number">1</span>,m) a[i]=<span class="built_in">read</span>();</span><br><span class="line">	<span class="built_in">solve</span>(<span class="number">1</span>,<span class="number">1</span>,k);</span><br><span class="line">	F=<span class="built_in">MulT</span>(F,(~P[<span class="number">1</span>]));</span><br><span class="line">	<span class="built_in">solve</span>(<span class="number">1</span>,<span class="number">1</span>,k,F);</span><br><span class="line">	<span class="built_in">fo</span>(i,<span class="number">1</span>,m) <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans[i]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line">ll fc[N],fv[N],iv[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">PolyInit</span>();</span><br><span class="line">    fc[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">1</span>,n) fc[i]=fc[i<span class="number">-1</span>]*i%mod;</span><br><span class="line">    fv[n]=<span class="built_in">Pow</span>(fc[n],mod<span class="number">-2</span>);</span><br><span class="line">    <span class="built_in">fd</span>(i,n,<span class="number">1</span>) fv[i<span class="number">-1</span>]=fv[i]*i%mod;</span><br><span class="line">    iv[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">2</span>,n) iv[i]=(mod-mod/i)*iv[mod%i]%mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">calcS</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;<span class="comment">//第一类斯特林数</span></span><br><span class="line">    <span class="keyword">if</span>(!n) &#123;s[<span class="number">0</span>]=<span class="number">1</span>; <span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">1</span>) &#123;s[<span class="number">1</span>]=<span class="number">1</span>; <span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span>(n&amp;<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">calcS</span>(n<span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">fd</span>(i,n,<span class="number">1</span>) s[i]=<span class="built_in">Add</span>(s[i<span class="number">-1</span>],<span class="built_in">Mul</span>(s[i],n<span class="number">-1</span>));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">calcS</span>(n&gt;&gt;<span class="number">1</span>); <span class="type">int</span> l=n&gt;&gt;<span class="number">1</span>,len;</span><br><span class="line">        <span class="keyword">for</span>(len=<span class="number">1</span>;len&lt;=n;len&lt;&lt;=<span class="number">1</span>);</span><br><span class="line">        d[<span class="number">0</span>]=<span class="number">1</span>; <span class="built_in">fo</span>(i,<span class="number">1</span>,l) d[i]=d[i<span class="number">-1</span>]*l%mod;</span><br><span class="line">        <span class="built_in">fo</span>(i,<span class="number">0</span>,l) d[i]=d[i]*fv[i]%mod,c[i]=s[i]*fc[i]%mod;</span><br><span class="line">        <span class="built_in">reverse</span>(&amp;d[<span class="number">0</span>],&amp;d[l+<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">ntt</span>(d,len,<span class="number">1</span>); <span class="built_in">ntt</span>(c,len,<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">fo</span>(i,<span class="number">0</span>,len<span class="number">-1</span>) d[i]=d[i]*c[i]%mod;</span><br><span class="line">        <span class="built_in">ntt</span>(d,len,<span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">fo</span>(i,<span class="number">0</span>,l) d[i]=d[i+l]*fv[i]%mod;</span><br><span class="line">        <span class="built_in">fo</span>(i,l+<span class="number">1</span>,len<span class="number">-1</span>) d[i]=c[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">fo</span>(i,<span class="number">0</span>,l) c[i]=s[i];</span><br><span class="line">        <span class="built_in">ntt</span>(d,len,<span class="number">1</span>); <span class="built_in">ntt</span>(c,len,<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">fo</span>(i,<span class="number">0</span>,len<span class="number">-1</span>) d[i]=d[i]*c[i]%mod;</span><br><span class="line">        <span class="built_in">ntt</span>(d,len,<span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">fo</span>(i,<span class="number">0</span>,n) s[i]=d[i];</span><br><span class="line">        <span class="built_in">fo</span>(i,<span class="number">0</span>,len<span class="number">-1</span>) d[i]=c[i]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">calcB</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line"><span class="comment">//求伯努利数</span></span><br><span class="line"><span class="comment">//原理:伯努利数的EGF=x/(e^x-1)</span></span><br><span class="line"><span class="comment">//sum(i=[0,n-1])[B_i*C(n,i)]=0(n&gt;1)</span></span><br><span class="line">    n+=<span class="number">2</span>;</span><br><span class="line">    B.<span class="built_in">resize</span>(n+<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) B[i]=fv[i+<span class="number">1</span>];</span><br><span class="line">    B=~B;</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">0</span>,n) B[i]=B[i]*fc[i]%mod;</span><br><span class="line">    B.<span class="built_in">resize</span>(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="线性代数"><a href="#线性代数" class="headerlink" title="线性代数"></a>线性代数</h2><h3 id="矩阵相关"><a href="#矩阵相关" class="headerlink" title="矩阵相关"></a>矩阵相关</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">502</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">matrix</span>&#123;</span><br><span class="line">	ll a[N][N];</span><br><span class="line">	<span class="built_in">matrix</span>()&#123;<span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="built_in">sizeof</span>(a));&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;<span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="built_in">sizeof</span>(a));&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">namespace</span> Mat&#123;</span><br><span class="line">	<span class="type">static</span> ll a[N][N],b[N][N+N],c[N][N],d[N][N];</span><br><span class="line">	<span class="type">static</span> matrix B,C;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> ll <span class="title">det</span><span class="params">(<span class="type">const</span> matrix &amp;A,<span class="type">int</span> n)</span><span class="comment">//行列式</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n) <span class="built_in">fo</span>(j,<span class="number">1</span>,n) a[i][j]=A.a[i][j];</span><br><span class="line">		ll d=<span class="number">1</span>,iv,tmp;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">int</span> k=i;</span><br><span class="line">			<span class="built_in">fo</span>(j,i+<span class="number">1</span>,n) <span class="keyword">if</span>(a[j][i]) &#123;k=j; <span class="keyword">break</span>;&#125;</span><br><span class="line">			<span class="keyword">if</span>(k!=i) &#123;<span class="built_in">fo</span>(j,i,n) <span class="built_in">swap</span>(a[k][j],a[i][j]); d=(mod-d)%mod;&#125;</span><br><span class="line">			<span class="keyword">if</span>(!a[i][i]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">			iv=<span class="built_in">Pow</span>(a[i][i],mod<span class="number">-2</span>);</span><br><span class="line">			<span class="built_in">fo</span>(j,i+<span class="number">1</span>,n)</span><br><span class="line">			&#123;</span><br><span class="line">				tmp=a[j][i]*iv%mod;</span><br><span class="line">				<span class="built_in">fo</span>(k,i,n) a[j][k]=<span class="built_in">Dec</span>(a[j][k],a[i][k]*tmp%mod);</span><br><span class="line">			&#125;</span><br><span class="line">			d=d*a[i][i]%mod;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> d;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> matrix <span class="title">inv</span><span class="params">(<span class="type">const</span> matrix &amp;A,<span class="type">int</span> n)</span><span class="comment">//求逆</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n) <span class="built_in">fo</span>(j,<span class="number">1</span>,n) b[i][j+n]=<span class="number">0</span>,b[i][j]=A.a[i][j];</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n) b[i][i+n]=<span class="number">1</span>;</span><br><span class="line">		ll iv,tmp;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">int</span> k=n+<span class="number">1</span>;</span><br><span class="line">			<span class="built_in">fo</span>(j,i,n) <span class="keyword">if</span>(b[j][i]) &#123;k=j; <span class="keyword">break</span>;&#125;</span><br><span class="line">			<span class="keyword">if</span>(k==n+<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">if</span>(k!=i) <span class="built_in">fo</span>(j,<span class="number">1</span>,n+n) <span class="built_in">swap</span>(b[i][j],b[k][j]);</span><br><span class="line">			iv=<span class="built_in">Pow</span>(b[i][i],mod<span class="number">-2</span>);</span><br><span class="line">			<span class="built_in">fo</span>(j,i+<span class="number">1</span>,n)</span><br><span class="line">			&#123;</span><br><span class="line">				tmp=b[j][i]*iv%mod;</span><br><span class="line">				<span class="built_in">fo</span>(k,i,n+n) b[j][k]=<span class="built_in">Dec</span>(b[j][k],b[i][k]*tmp%mod);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">fd</span>(i,n,<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			iv=<span class="built_in">Pow</span>(b[i][i],mod<span class="number">-2</span>);</span><br><span class="line">			<span class="built_in">fo</span>(j,i,n+n) b[i][j]=b[i][j]*iv%mod;</span><br><span class="line">			<span class="built_in">fd</span>(j,i<span class="number">-1</span>,<span class="number">1</span>)</span><br><span class="line">				<span class="keyword">if</span>(b[j][i])</span><br><span class="line">				&#123;</span><br><span class="line">					tmp=b[j][i];</span><br><span class="line">					<span class="built_in">fo</span>(k,i,n+n) b[j][k]=<span class="built_in">Dec</span>(b[j][k],b[i][k]*tmp%mod);</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		B.<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n) <span class="built_in">fo</span>(j,<span class="number">1</span>,n) B.a[i][j]=b[i][j+n];</span><br><span class="line">		<span class="keyword">return</span> B;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">r</span><span class="params">(<span class="type">const</span> matrix A,<span class="type">int</span> n)</span><span class="comment">//求秩</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n) <span class="built_in">fo</span>(j,<span class="number">1</span>,n) a[i][j]=A.a[i][j];</span><br><span class="line">		<span class="type">int</span> d=<span class="number">0</span>;</span><br><span class="line">		ll iv,tmp;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">int</span> k=n+<span class="number">1</span>;</span><br><span class="line">			<span class="built_in">fo</span>(j,i,n) <span class="keyword">if</span>(a[j][i]) &#123;k=j; <span class="keyword">break</span>;&#125;</span><br><span class="line">			<span class="keyword">if</span>(k==n+<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">			d++;</span><br><span class="line">			<span class="keyword">if</span>(k!=i) <span class="built_in">fo</span>(j,i,n) <span class="built_in">swap</span>(a[i][j],a[k][j]);</span><br><span class="line">			iv=<span class="built_in">Pow</span>(a[i][i],mod<span class="number">-2</span>);</span><br><span class="line">			<span class="built_in">fo</span>(j,i+<span class="number">1</span>,n)</span><br><span class="line">			&#123;</span><br><span class="line">				tmp=a[j][i]*iv%mod;</span><br><span class="line">				<span class="built_in">fo</span>(k,i,n) a[j][k]=<span class="built_in">Dec</span>(a[j][k],tmp*a[i][k]%mod);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> d;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">static</span> ll v[N],w[N];</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">ins</span><span class="params">(ll *v,<span class="type">int</span> n,<span class="type">int</span> id,ll *ans)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n) w[i]=<span class="number">0</span>;</span><br><span class="line">		w[id]=<span class="number">1</span>;</span><br><span class="line">		ll tmp;</span><br><span class="line">		<span class="built_in">fd</span>(i,n,<span class="number">1</span>)</span><br><span class="line">			<span class="keyword">if</span>(v[i])</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(!c[i][i])</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">fd</span>(j,i,<span class="number">1</span>) c[i][j]=v[j];</span><br><span class="line">					<span class="built_in">fo</span>(j,<span class="number">1</span>,n) d[i][j]=w[j];</span><br><span class="line">					<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				tmp=<span class="built_in">Pow</span>(c[i][i],mod<span class="number">-2</span>)*v[i]%mod;</span><br><span class="line">				<span class="built_in">fd</span>(j,i,<span class="number">1</span>) v[j]=<span class="built_in">Dec</span>(v[j],c[i][j]*tmp%mod);</span><br><span class="line">				<span class="built_in">fo</span>(j,<span class="number">1</span>,n) w[j]=<span class="built_in">Dec</span>(w[j],d[i][j]*tmp%mod);</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n) ans[i]=w[i];</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">get_G</span><span class="params">(<span class="type">const</span> matrix &amp;A,<span class="type">int</span> n,ll *p)</span><span class="comment">//解齐次线性方程非零解</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n) <span class="built_in">fo</span>(j,<span class="number">1</span>,n) a[i][j]=A.a[i][j];</span><br><span class="line">		<span class="built_in">memset</span>(c,<span class="number">0</span>,<span class="built_in">sizeof</span>(c)); <span class="built_in">memset</span>(d,<span class="number">0</span>,<span class="built_in">sizeof</span>(d));</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">fo</span>(j,<span class="number">1</span>,n) v[j]=a[j][i];</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">ins</span>(v,n,i,p)) <span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> matrix <span class="title">solve</span><span class="params">(<span class="type">const</span> matrix &amp;A,<span class="type">int</span> n)</span><span class="comment">//求所有代数余子式</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="type">int</span> rank=<span class="built_in">r</span>(A,n);</span><br><span class="line">		<span class="keyword">if</span>(rank == n)</span><br><span class="line">		&#123;</span><br><span class="line">			ll d=<span class="built_in">det</span>(A,n);</span><br><span class="line">			B=<span class="built_in">inv</span>(A,n);</span><br><span class="line">			<span class="built_in">fo</span>(i,<span class="number">1</span>,n) <span class="built_in">fo</span>(j,<span class="number">1</span>,n) C.a[i][j]=B.a[j][i]*d%mod;</span><br><span class="line">			<span class="keyword">return</span> C;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(rank &lt;= n<span class="number">-2</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			C.<span class="built_in">clear</span>();</span><br><span class="line">			<span class="keyword">return</span> C;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">static</span> ll p[N],q[N];</span><br><span class="line">			<span class="built_in">get_G</span>(A,n,q);</span><br><span class="line">			<span class="built_in">fo</span>(i,<span class="number">1</span>,n) <span class="built_in">fo</span>(j,<span class="number">1</span>,n) B.a[j][i]=A.a[i][j];</span><br><span class="line">			<span class="built_in">get_G</span>(B,n,p);</span><br><span class="line">			<span class="type">int</span> c=<span class="number">0</span>,r=<span class="number">0</span>;</span><br><span class="line">			<span class="built_in">fo</span>(i,<span class="number">1</span>,n) <span class="keyword">if</span>(q[i]) &#123;c=i; <span class="keyword">break</span>;&#125;</span><br><span class="line">			<span class="built_in">fo</span>(i,<span class="number">1</span>,n) <span class="keyword">if</span>(p[i]) &#123;r=i; <span class="keyword">break</span>;&#125;</span><br><span class="line">			<span class="built_in">fo</span>(i,<span class="number">1</span>,n)</span><br><span class="line">				<span class="keyword">if</span>(i!=r)</span><br><span class="line">					<span class="built_in">fo</span>(j,<span class="number">1</span>,n)</span><br><span class="line">						<span class="keyword">if</span>(j!=c)</span><br><span class="line">							B.a[i-(i&gt;r)][j-(j&gt;c)]=A.a[i][j];</span><br><span class="line">			ll d=<span class="built_in">det</span>(B,n<span class="number">-1</span>);</span><br><span class="line">			C.a[r][c]=((r+c)%<span class="number">2</span>==<span class="number">1</span>)?(mod-d)%mod:d;</span><br><span class="line">			ll iv=<span class="built_in">Pow</span>(q[c]*p[r]%mod,mod<span class="number">-2</span>);</span><br><span class="line">			<span class="built_in">fo</span>(i,<span class="number">1</span>,n)</span><br><span class="line">				<span class="built_in">fo</span>(j,<span class="number">1</span>,n)</span><br><span class="line">					C.a[i][j]=C.a[r][c]*iv%mod*p[i]%mod*q[j]%mod;</span><br><span class="line">			<span class="keyword">return</span> C;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="图论"><a href="#图论" class="headerlink" title="图论"></a>图论</h1><h2 id="KM算法"><a href="#KM算法" class="headerlink" title="KM算法"></a>KM算法</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">505</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> inf=<span class="number">1e9</span>;</span><br><span class="line"><span class="keyword">namespace</span> Graph&#123;</span><br><span class="line">	<span class="type">int</span> n,w[N][N],l[N];</span><br><span class="line">	<span class="type">int</span> lx[N],ly[N],slk[N],pre[N];</span><br><span class="line">	<span class="type">bool</span> visy[N];</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="type">int</span> v=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">0</span>,n) pre[i]=visy[i]=<span class="number">0</span>,slk[i]=inf;</span><br><span class="line">		l[v]=u;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> t,d,id;;)</span><br><span class="line">		&#123;</span><br><span class="line">			t=l[v]; d=inf; visy[v]=<span class="number">1</span>;</span><br><span class="line">			<span class="built_in">fo</span>(i,<span class="number">1</span>,n)</span><br><span class="line">				<span class="keyword">if</span>(!visy[i])</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span>(slk[i]&gt;lx[t]+ly[i]-w[t][i])</span><br><span class="line">						slk[i]=lx[t]+ly[i]-w[t][i],pre[i]=v;</span><br><span class="line">					<span class="keyword">if</span>(d&gt;slk[i]) d=slk[i],id=i;</span><br><span class="line">				&#125;</span><br><span class="line">			<span class="built_in">fo</span>(i,<span class="number">0</span>,n)</span><br><span class="line">				<span class="keyword">if</span>(!visy[i]) slk[i]-=d;</span><br><span class="line">				<span class="keyword">else</span> lx[l[i]]-=d,ly[i]+=d;</span><br><span class="line">			v=id;</span><br><span class="line">			<span class="keyword">if</span>(l[v]==<span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">for</span>(;v;l[v]=l[pre[v]],v=pre[v]);</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">KM</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//calculate w</span></span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n) lx[i]=ly[i]=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n) <span class="built_in">fo</span>(j,<span class="number">1</span>,n) lx[i]=<span class="built_in">max</span>(lx[i],w[i][j]);</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n) <span class="built_in">bfs</span>(i);</span><br><span class="line">		<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n) ans+=w[l[i]][i];</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="网络流"><a href="#网络流" class="headerlink" title="网络流"></a>网络流</h2><h3 id="Dinic"><a href="#Dinic" class="headerlink" title="Dinic"></a>Dinic</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> Dinic&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> inf=<span class="number">2e9</span>;</span><br><span class="line">	<span class="type">int</span> n,s,t,d[N]; queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">	<span class="type">int</span> head[N],cur[N],ne[M],ver[M],val[M],tot=<span class="number">1</span>;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">0</span>,n) head[i]=<span class="number">0</span>; tot=<span class="number">1</span>; n=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		ver[++tot]=y; val[tot]=v; ne[tot]=head[x]; head[x]=tot;</span><br><span class="line">		ver[++tot]=x; val[tot]=<span class="number">0</span>; ne[tot]=head[y]; head[y]=tot;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">0</span>,n) cur[i]=head[i];</span><br><span class="line">		<span class="keyword">for</span>(;!q.<span class="built_in">empty</span>();q.<span class="built_in">pop</span>());</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">0</span>,n) d[i]=<span class="number">-1</span>; q.<span class="built_in">push</span>(s); d[s]=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> u,v;!q.<span class="built_in">empty</span>();)</span><br><span class="line">		&#123;</span><br><span class="line">			u=q.<span class="built_in">front</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i=head[u];i;i=ne[i])</span><br><span class="line">				<span class="keyword">if</span>(val[i]&amp;&amp;d[v=ver[i]]==<span class="number">-1</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					d[v]=d[u]+<span class="number">1</span>,q.<span class="built_in">push</span>(v);</span><br><span class="line">					<span class="keyword">if</span>(v==t) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> flow)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!flow||u==t) <span class="keyword">return</span> flow;</span><br><span class="line">		<span class="type">int</span> res=flow,r,v;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> &amp;i=cur[u];i;i=ne[i])</span><br><span class="line">			<span class="keyword">if</span>(val[i]&amp;&amp;d[v=ver[i]]==d[u]+<span class="number">1</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				r=<span class="built_in">dfs</span>(v,<span class="built_in">min</span>(res,val[i]));</span><br><span class="line">				<span class="keyword">if</span>(!r) <span class="keyword">continue</span>;</span><br><span class="line">				val[i]-=r; val[i^<span class="number">1</span>]+=r;</span><br><span class="line">				res-=r; <span class="keyword">if</span>(!res) <span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">return</span> flow-res;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">dinic</span><span class="params">(<span class="type">int</span> flow=<span class="number">0</span>)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(<span class="built_in">bfs</span>()) flow+=<span class="built_in">dfs</span>(s,inf);</span><br><span class="line">		<span class="keyword">return</span> flow;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Dijkstra优化费用流"><a href="#Dijkstra优化费用流" class="headerlink" title="Dijkstra优化费用流"></a>Dijkstra优化费用流</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> Graph&#123;</span><br><span class="line">	<span class="type">int</span> n,m,s,t;</span><br><span class="line">	<span class="type">int</span> ver[M],val[M],cost[M],ne[M],head[N],tot=<span class="number">1</span>;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> v,<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		ver[++tot]=y; val[tot]=v; cost[tot]=c; ne[tot]=head[x]; head[x]=tot;</span><br><span class="line">		ver[++tot]=x; val[tot]=<span class="number">0</span>; cost[tot]=-c;ne[tot]=head[y]; head[y]=tot;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> h[N],dis[N];</span><br><span class="line">	<span class="type">bool</span> vis[N];</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">spfa</span><span class="params">(<span class="type">int</span> s,<span class="type">int</span> t)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) h[i]=inf;</span><br><span class="line">		queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">		<span class="keyword">for</span>(h[s]=<span class="number">0</span>,q.<span class="built_in">push</span>(s);!q.<span class="built_in">empty</span>();)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">int</span> u=q.<span class="built_in">front</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i=head[u],v;i;i=ne[i])</span><br><span class="line">				<span class="keyword">if</span>(val[i]&amp;&amp;h[v=ver[i]]&gt;h[u]+cost[i])</span><br><span class="line">				&#123;</span><br><span class="line">					h[v]=h[u]+cost[i];</span><br><span class="line">					<span class="keyword">if</span>(!vis[v]) q.<span class="built_in">push</span>(v),vis[v]=<span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			vis[u]=<span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">node</span>&#123;</span><br><span class="line">		<span class="type">int</span> u,dis;</span><br><span class="line">		<span class="keyword">friend</span> <span class="keyword">inline</span> <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> node &amp;A,<span class="type">const</span> node &amp;B)&#123;<span class="keyword">return</span> A.dis&gt;B.dis;&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">int</span> pv[N],pe[N];</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">MCMF</span><span class="params">(<span class="type">int</span> s,<span class="type">int</span> t)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="type">int</span> flow=<span class="number">0</span>,co=<span class="number">0</span>;</span><br><span class="line">		priority_queue&lt;node&gt; q;</span><br><span class="line">		<span class="keyword">for</span>(;;)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) dis[i]=inf;</span><br><span class="line">			<span class="keyword">for</span>(dis[s]=<span class="number">0</span>,q.<span class="built_in">push</span>((node)&#123;s,dis[s]&#125;);!q.<span class="built_in">empty</span>();)</span><br><span class="line">			&#123;</span><br><span class="line">				node now=q.<span class="built_in">top</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">				<span class="type">int</span> u=now.u;</span><br><span class="line">				<span class="keyword">if</span>(dis[u]&lt;now.dis) <span class="keyword">continue</span>;</span><br><span class="line">				<span class="keyword">for</span>(<span class="type">int</span> i=head[u],v;i;i=ne[i])</span><br><span class="line">				<span class="keyword">if</span>(val[i])</span><br><span class="line">				&#123;</span><br><span class="line">					v=ver[i];</span><br><span class="line">					<span class="keyword">if</span>(dis[v]+h[v]&gt;dis[u]+h[u]+cost[i])</span><br><span class="line">						dis[v]=dis[u]+h[u]+cost[i]-h[v],</span><br><span class="line">						q.<span class="built_in">push</span>((node)&#123;v,dis[v]&#125;),</span><br><span class="line">						pv[v]=u,pe[v]=i;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(dis[t]==inf) <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) h[i]+=dis[i];</span><br><span class="line">			<span class="type">int</span> tmp=inf;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> u=t;u!=s;u=pv[u]) tmp=<span class="built_in">min</span>(tmp,val[pe[u]]);</span><br><span class="line">			flow+=tmp; co+=h[t]*tmp;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> u=t,i;u!=s;u=pv[u]) i=pe[u],val[i]-=tmp,val[i^<span class="number">1</span>]+=tmp;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,flow,co);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="K短路（可持久化可并堆优化）"><a href="#K短路（可持久化可并堆优化）" class="headerlink" title="K短路（可持久化可并堆优化）"></a>K短路（可持久化可并堆优化）</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">2.6e5</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M=N*<span class="number">3</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> K=<span class="number">2e7</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;</span><br><span class="line">	<span class="type">int</span> head[N],ne[M],ver[M],tot;</span><br><span class="line">	ll val[M];</span><br><span class="line">	<span class="built_in">Edge</span>()&#123;tot=<span class="number">0</span>;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> z)</span> </span>&#123;</span><br><span class="line">		ver[++tot]=y; val[tot]=z; ne[tot]=head[x]; head[x]=tot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;E1,E2;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>&#123;</span><br><span class="line">	<span class="type">int</span> u;ll d;</span><br><span class="line">	node* <span class="keyword">operator</span>=(node a)&#123;u=a.u,d=a.d; <span class="keyword">return</span> <span class="keyword">this</span>;&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">inline</span> <span class="type">bool</span> <span class="keyword">operator</span>&lt;(node A,node B) &#123;</span><br><span class="line">		<span class="keyword">return</span> A.d&gt;B.d;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> rt[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Heap</span>&#123;</span><br><span class="line">	<span class="type">int</span> cnt,lc[K],rc[K],d[K];</span><br><span class="line">	node v[K];</span><br><span class="line">	<span class="built_in">Heap</span>()&#123;d[<span class="number">0</span>]=<span class="number">-1</span>;&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">newnode</span><span class="params">(node w)</span> </span>&#123;</span><br><span class="line">		v[++cnt]=w;</span><br><span class="line">		<span class="keyword">return</span> cnt;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!x||!y) <span class="keyword">return</span> x+y;</span><br><span class="line">		<span class="keyword">if</span>(v[x]&lt;v[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">		<span class="type">int</span> u=++cnt;</span><br><span class="line">		lc[u]=lc[x];</span><br><span class="line">		v[u]=v[x];</span><br><span class="line">		rc[u]=<span class="built_in">merge</span>(rc[x],y);</span><br><span class="line">		<span class="keyword">if</span>(d[lc[u]]&lt;d[rc[u]]) <span class="built_in">swap</span>(lc[u],rc[u]);</span><br><span class="line">		d[u]=d[rc[u]]+<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">return</span> u;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;st;</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line">priority_queue&lt;node&gt; q;</span><br><span class="line"><span class="type">bool</span> bo[N],vis[N],on_tree[M];</span><br><span class="line">ll dis[N];</span><br><span class="line"><span class="type">int</span> fa[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">	bo[u]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=E2.head[u],v;i;i=E2.ne[i])</span><br><span class="line">	&#123;</span><br><span class="line">		v=E2.ver[i];</span><br><span class="line">		<span class="keyword">if</span>(bo[v]) <span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">if</span>(dis[v]==dis[u]+E2.val[i])</span><br><span class="line">			fa[v]=u,on_tree[i]=<span class="number">1</span>,<span class="built_in">dfs</span>(v);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dijkstra</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(dis,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(dis));</span><br><span class="line">	q.<span class="built_in">push</span>(&#123;s,<span class="number">0</span>&#125;); dis[s]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(;!q.<span class="built_in">empty</span>();) &#123;</span><br><span class="line">		<span class="keyword">auto</span> a=q.<span class="built_in">top</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="keyword">if</span>(vis[a.u]) <span class="keyword">continue</span>;</span><br><span class="line">		vis[a.u]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=E2.head[a.u],v;i;i=E2.ne[i]) &#123;</span><br><span class="line">			v=E2.ver[i];</span><br><span class="line">			<span class="keyword">if</span>(dis[v]&gt;dis[a.u]+E2.val[i]) &#123;</span><br><span class="line">				dis[v]=dis[a.u]+E2.val[i];</span><br><span class="line">				q.<span class="built_in">push</span>(&#123;v,dis[v]&#125;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">	bo[u]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(fa[u]) rt[u]=st.<span class="built_in">merge</span>(rt[u],rt[fa[u]]);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=E2.head[u],v;i;i=E2.ne[i]) &#123;</span><br><span class="line">		v=E2.ver[i];</span><br><span class="line">		<span class="keyword">if</span>(!bo[v]&amp;&amp;fa[v]==u) <span class="built_in">dfs2</span>(v);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> z)</span> </span>&#123;</span><br><span class="line">	E1.<span class="built_in">add</span>(x,y,z); E2.<span class="built_in">add</span>(y,x,z);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"><span class="type">int</span> s,t;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	n=<span class="built_in">read</span>(); m=<span class="built_in">read</span>();</span><br><span class="line">    <span class="type">int</span> x,y,z;</span><br><span class="line">	<span class="built_in">fo</span>(i,<span class="number">1</span>,m) &#123;</span><br><span class="line">        x=<span class="built_in">read</span>(); y=<span class="built_in">read</span>(); z=<span class="built_in">read</span>(); <span class="built_in">add</span>(x,y,z);</span><br><span class="line">    &#125;</span><br><span class="line">	s=<span class="number">1</span>; t=n;</span><br><span class="line">	<span class="built_in">dijkstra</span>(t);</span><br><span class="line">	<span class="built_in">dfs</span>(t);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,dis[s]);</span><br><span class="line">	k--;</span><br><span class="line">	<span class="keyword">if</span>(!k) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">fo</span>(u,s,t)</span><br><span class="line">		<span class="keyword">if</span>(vis[u])</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=E1.head[u],v;i;i=E1.ne[i])</span><br><span class="line">			<span class="keyword">if</span>(!on_tree[i]&amp;&amp;vis[v=E1.ver[i]])</span><br><span class="line">				rt[u]=st.<span class="built_in">merge</span>(rt[u],st.<span class="built_in">newnode</span>(&#123;v,dis[v]-dis[u]+E1.val[i]&#125;));</span><br><span class="line">	<span class="built_in">fo</span>(i,s,t) bo[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">dfs2</span>(t);</span><br><span class="line">	<span class="keyword">if</span>(rt[s]) q.<span class="built_in">push</span>((node)&#123;rt[s],dis[s]+st.v[rt[s]].d&#125;);</span><br><span class="line">	<span class="keyword">for</span>(;!q.<span class="built_in">empty</span>();) &#123;</span><br><span class="line">		<span class="keyword">auto</span> now=q.<span class="built_in">top</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">		k--; <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,now.d);</span><br><span class="line">		<span class="keyword">if</span>(!k) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(st.lc[now.u]) q.<span class="built_in">push</span>((node)&#123;st.lc[now.u],now.d-st.v[now.u].d+st.v[st.lc[now.u]].d&#125;);</span><br><span class="line">		<span class="keyword">if</span>(st.rc[now.u]) q.<span class="built_in">push</span>((node)&#123;st.rc[now.u],now.d-st.v[now.u].d+st.v[st.rc[now.u]].d&#125;);</span><br><span class="line">		<span class="type">int</span> u=rt[st.v[now.u].u];</span><br><span class="line">		<span class="keyword">if</span>(u) q.<span class="built_in">push</span>((node)&#123;u,now.d+st.v[u].d&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">fo</span>(i,<span class="number">1</span>,k) <span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="环计数，K4计数"><a href="#环计数，K4计数" class="headerlink" title="环计数，K4计数"></a>环计数，K4计数</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">        d[i]=<span class="number">0</span>,</span><br><span class="line">        adj[i].<span class="built_in">clear</span>(),vec[i].<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) &#123;</span><br><span class="line">        <span class="type">int</span> x,y;</span><br><span class="line">        <span class="built_in">read</span>(x); <span class="built_in">read</span>(y);</span><br><span class="line">        d[x]++; d[y]++;</span><br><span class="line">        adj[x].<span class="built_in">pb</span>(y); adj[y].<span class="built_in">pb</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j:adj[i])</span><br><span class="line">            <span class="keyword">if</span>(d[i] &gt; d[j] || (d[i] == d[j] &amp;&amp; i &gt; j))</span><br><span class="line">                vec[i].<span class="built_in">pb</span>(j);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Count3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> u=<span class="number">1</span>;u&lt;=n;u++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> v:vec[u])</span><br><span class="line">            tmp[v] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> v:vec[u])</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> w:vec[v])</span><br><span class="line">                <span class="keyword">if</span>(tmp[w])</span><br><span class="line">                    ans++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> v:vec[u])</span><br><span class="line">            tmp[v] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">Count4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> u=<span class="number">1</span>;u&lt;=n;u++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> v:vec[u])</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> w:adj[v])</span><br><span class="line">                <span class="keyword">if</span>(d[u] &gt; d[w] || (d[u] == d[w] &amp;&amp; u &gt; w)) &#123;</span><br><span class="line">                    ans += tmp[w];</span><br><span class="line">                    tmp[w] ++;</span><br><span class="line">                &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> v:vec[u])</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> w:adj[v])</span><br><span class="line">                tmp[w] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bitset&lt;sqrt(2m)&gt; b[sqrt(2m)];</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">CountK4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">1</span>,n) id[i] = i;</span><br><span class="line">    <span class="built_in">sort</span>(id+<span class="number">1</span>,id+n+<span class="number">1</span>,[&amp;](<span class="type">const</span> <span class="type">int</span> &amp;x,<span class="type">const</span> <span class="type">int</span> &amp;y) &#123;</span><br><span class="line">        <span class="keyword">if</span>(deg[x] != deg[y])</span><br><span class="line">            <span class="keyword">return</span> deg[x] &lt; deg[y];</span><br><span class="line">        <span class="keyword">return</span> x &lt; y;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">1</span>,n) rk[id[i]] = i;</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">1</span>,n)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j:adj[i])</span><br><span class="line">            <span class="keyword">if</span>(rk[i] &lt; rk[j])</span><br><span class="line">                vec[i].<span class="built_in">pb</span>(j);</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(num,<span class="number">-1</span>,<span class="built_in">sizeof</span>(num));</span><br><span class="line">    <span class="built_in">fo</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">        <span class="type">int</span> u = id[i], tim = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> v:vec[u])</span><br><span class="line">            num[v] = tim++;</span><br><span class="line">        <span class="built_in">assert</span>(tim &lt;= K);</span><br><span class="line">        <span class="built_in">ff</span>(j,<span class="number">0</span>,tim)</span><br><span class="line">            b[j].<span class="built_in">reset</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> v:vec[u])</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> w:vec[v])</span><br><span class="line">                <span class="keyword">if</span>(num[w] != <span class="number">-1</span>)</span><br><span class="line">                    b[num[v]][num[w]] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> v:vec[u])</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> w:vec[v])</span><br><span class="line">                <span class="keyword">if</span>(num[w] != <span class="number">-1</span>) &#123;</span><br><span class="line">                    a = b[num[v]] &amp; b[num[w]];</span><br><span class="line">                    ans += a.<span class="built_in">count</span>();</span><br><span class="line">                &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> v:vec[u])</span><br><span class="line">            num[v] = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="弦图"><a href="#弦图" class="headerlink" title="弦图"></a>弦图</h2><p>$N(x)$，与 $x$ 直接相连的点集。</p>
<p>单纯点：${x}+N(x)$ 的诱导子图为一个团。</p>
<p>完美消除序列：$v_1,v_2,\cdots,v_n$，其中 $v_i$ 在 ${v_i,v_{i+1},\cdots,v_n}$ 中为单纯点。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//v即为完美消除序列，pos即为点i在完美消除序列上的位置</span></span><br><span class="line"><span class="comment">//判断v是否为完美消除序列，根据定义即可 O(n+m) 判断。</span></span><br><span class="line"><span class="comment">//极大团可通过不存在nxt_y=x且|N(x)|+1&lt;=|N(y)|判断</span></span><br><span class="line"><span class="comment">//完美消除序列从后往前染色=色数=最大团点数</span></span><br><span class="line"><span class="comment">//完美消除序列从后往前选能选的点=最大独立集=最小团覆盖</span></span><br><span class="line"><span class="type">int</span> id[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; adj[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;adj[x].<span class="built_in">pb</span>(y); adj[y].<span class="built_in">pb</span>(x);&#125;</span><br><span class="line"><span class="type">int</span> head[N],ne[N],ver[N],tot=<span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> best,label[N];</span><br><span class="line"><span class="type">bool</span> bo[N];</span><br><span class="line"><span class="type">int</span> pos[N],v[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	ver[++tot]=x; ne[tot]=head[i]; head[i]=tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">del</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">	head[i]=ne[head[i]];</span><br><span class="line">	<span class="keyword">for</span>(;!head[best];best--);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">MCS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	best=<span class="number">0</span>; <span class="built_in">fo</span>(i,<span class="number">1</span>,n) <span class="built_in">add</span>(<span class="number">0</span>,i),label[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">fd</span>(i,n,<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> x=ver[head[best]];</span><br><span class="line">		<span class="keyword">while</span>(bo[x]) <span class="built_in">del</span>(best),x=ver[head[best]];</span><br><span class="line">		bo[x]=<span class="number">1</span>;</span><br><span class="line">		pos[x]=i; v[i]=x;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">auto</span> y:adj[x]) <span class="keyword">if</span>(!bo[y]) <span class="built_in">add</span>(++label[y],y),best=<span class="built_in">max</span>(best,label[y]);</span><br><span class="line">	&#125;</span><br><span class="line">	ll ans=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">fd</span>(i,n,<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> x=v[i],num=c;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">auto</span> y:adj[x]) <span class="keyword">if</span>(pos[y]&gt;pos[x]) num--;</span><br><span class="line">		ans=ans*num%<span class="number">1000000007ll</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="最小树形图（朱-刘算法）"><a href="#最小树形图（朱-刘算法）" class="headerlink" title="最小树形图（朱-刘算法）"></a>最小树形图（朱-刘算法）</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">200010</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>&#123;</span><br><span class="line">	<span class="type">int</span> val,v,id;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">inline</span> <span class="type">bool</span> <span class="keyword">operator</span>&gt;(<span class="type">const</span> node &amp;A,<span class="type">const</span> node &amp;B)</span><br><span class="line">	&#123;<span class="keyword">return</span> A.val&gt;B.val;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Heap</span>&#123;</span><br><span class="line">	node v[N];</span><br><span class="line">	<span class="type">int</span> dis[N],ls[N],rs[N],tag[N];</span><br><span class="line">	<span class="type">bool</span> del[N];</span><br><span class="line">	<span class="type">int</span> rt[N];</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushtag</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> t)</span></span>&#123;<span class="keyword">if</span>(u) tag[u]+=t,v[u].val+=t;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!tag[u]) <span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">pushtag</span>(ls[u],tag[u]);</span><br><span class="line">		<span class="built_in">pushtag</span>(rs[u],tag[u]);</span><br><span class="line">		tag[u]=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!x||!y) <span class="keyword">return</span> x+y;</span><br><span class="line">		<span class="keyword">if</span>(v[x].val&gt;v[y].val) <span class="built_in">swap</span>(x,y);</span><br><span class="line">		<span class="built_in">pushtag</span>(y,-tag[x]);</span><br><span class="line">		rs[x]=<span class="built_in">merge</span>(rs[x],y);</span><br><span class="line">		<span class="keyword">if</span>(dis[ls[x]]&lt;dis[rs[x]]) <span class="built_in">swap</span>(ls[x],rs[x]);</span><br><span class="line">		dis[x]=dis[rs[x]]+<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">return</span> x;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">pop</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">		<span class="built_in">pushdown</span>(x); <span class="keyword">return</span> <span class="built_in">merge</span>(ls[x],rs[x]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ins</span><span class="params">(<span class="type">int</span> y,<span class="type">int</span> va,<span class="type">int</span> id,<span class="type">int</span> to)</span> </span>&#123;</span><br><span class="line">		v[id]=(node)&#123;va,to,id&#125;;</span><br><span class="line">		rt[y]=<span class="built_in">merge</span>(rt[y],id);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">dec</span><span class="params">(<span class="type">int</span> id,<span class="type">int</span> v)</span> </span>&#123;<span class="built_in">pushtag</span>(id,-v);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> node <span class="title">top</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(;rt[u]&amp;&amp;<span class="built_in">find</span>(v[rt[u]].v)==u;) rt[u]=<span class="built_in">pop</span>(rt[u]);</span><br><span class="line">		<span class="keyword">if</span>(!rt[u]) &#123;<span class="built_in">printf</span>(<span class="string">&quot;-1&quot;</span>); <span class="built_in">exit</span>(<span class="number">0</span>);&#125;</span><br><span class="line">		v[rt[u]].v=<span class="built_in">find</span>(v[rt[u]].v);</span><br><span class="line">		<span class="keyword">return</span> v[rt[u]];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Heap h;</span><br><span class="line"><span class="type">int</span> fa[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;<span class="keyword">return</span> fa[x]==x?x:fa[x]=<span class="built_in">find</span>(fa[x]);&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Union</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	u=<span class="built_in">find</span>(u); v=<span class="built_in">find</span>(v);</span><br><span class="line">	<span class="keyword">if</span>(u==v) <span class="keyword">return</span>;</span><br><span class="line">	h.rt[v]=h.<span class="built_in">merge</span>(h.rt[u],h.rt[v]),fa[u]=v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,m,rt,pre[N],bel[N];</span><br><span class="line">ll ans;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	n=<span class="built_in">read</span>(); m=<span class="built_in">read</span>(); rt=<span class="built_in">read</span>();</span><br><span class="line">	<span class="type">int</span> x,y,z;</span><br><span class="line">	<span class="built_in">fo</span>(i,<span class="number">1</span>,m) &#123;</span><br><span class="line">		x=<span class="built_in">read</span>(),y=<span class="built_in">read</span>(),z=<span class="built_in">read</span>();</span><br><span class="line">		h.<span class="built_in">ins</span>(y,z,i,x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> cnt=n;</span><br><span class="line">	node now;</span><br><span class="line">	bel[rt]=rt;</span><br><span class="line">	<span class="built_in">fo</span>(i,<span class="number">1</span>,n&lt;&lt;<span class="number">1</span>) fa[i]=i;</span><br><span class="line">	<span class="built_in">fo</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		<span class="type">int</span> j=i;</span><br><span class="line">		<span class="keyword">for</span>(;!bel[j];) &#123;</span><br><span class="line">			<span class="keyword">while</span>(!bel[j]) bel[j]=i,now=h.<span class="built_in">top</span>(j),ans+=now.val,j=now.v;</span><br><span class="line">			<span class="keyword">if</span>(bel[j]!=i) <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">for</span>(;bel[j]!=<span class="number">-1</span>;) bel[j]=<span class="number">-1</span>,j=pre[j]=(now=h.<span class="built_in">top</span>(j)).v,h.<span class="built_in">dec</span>(now.id,now.val);</span><br><span class="line">			++cnt;</span><br><span class="line">			<span class="keyword">for</span>(;bel[j]!=i;) bel[j]=i,<span class="built_in">Union</span>(j,cnt),j=pre[j];</span><br><span class="line">			j=cnt;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="带花树-O-n-3"><a href="#带花树-O-n-3" class="headerlink" title="带花树 $O(n^3)$"></a>带花树 $O(n^3)$</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> Graph&#123;</span><br><span class="line">	<span class="type">int</span> n,tim;</span><br><span class="line">	queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">	vector&lt;<span class="type">int</span>&gt; adj[N];</span><br><span class="line">	<span class="type">int</span> fa[N],t[N],vst[N],pre[N],matc[N];</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">		adj[x].<span class="built_in">pb</span>(y); adj[y].<span class="built_in">pb</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">LCA</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">		tim++; x=fa[x]; y=fa[y];</span><br><span class="line">		<span class="keyword">for</span>(;vst[x]!=tim;) &#123;</span><br><span class="line">			<span class="keyword">if</span>(x) &#123;</span><br><span class="line">				vst[x]=tim; x=fa[pre[matc[x]]];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">swap</span>(x,y);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> x;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">blossom</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> lca)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(;fa[x]!=lca;) &#123;</span><br><span class="line">			pre[x]=y; y=matc[x];</span><br><span class="line">			<span class="keyword">if</span>(t[y]==<span class="number">1</span>) &#123;</span><br><span class="line">				t[y]=<span class="number">0</span>; q.<span class="built_in">push</span>(y);</span><br><span class="line">			&#125;</span><br><span class="line">			fa[x]=fa[y]=fa[lca]; x=pre[y];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Augument</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n) fa[i]=i;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">0</span>,n) t[i]=<span class="number">-1</span>;</span><br><span class="line">		q=<span class="built_in">queue</span>&lt;<span class="type">int</span>&gt;();</span><br><span class="line">		t[s]=<span class="number">0</span>; q.<span class="built_in">push</span>(s);</span><br><span class="line">		<span class="keyword">for</span>(;!q.<span class="built_in">empty</span>();) &#123;</span><br><span class="line">			<span class="type">int</span> u=q.<span class="built_in">front</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> v:adj[u])</span><br><span class="line">				<span class="keyword">if</span>(t[v]==<span class="number">-1</span>) &#123;</span><br><span class="line">					pre[v]=u; t[v]=<span class="number">1</span>;</span><br><span class="line">					<span class="keyword">if</span>(!matc[v]) &#123;</span><br><span class="line">						<span class="keyword">for</span>(<span class="type">int</span> to=v,from=u;to;from=pre[to]) &#123;</span><br><span class="line">							matc[to]=from;</span><br><span class="line">							<span class="built_in">swap</span>(matc[from],to);</span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">					&#125;</span><br><span class="line">					t[matc[v]]=<span class="number">0</span>;</span><br><span class="line">					q.<span class="built_in">push</span>(matc[v]);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(t[v]==<span class="number">0</span>&amp;&amp;fa[u]!=fa[v]) &#123;</span><br><span class="line">					<span class="type">int</span> lca=<span class="built_in">LCA</span>(u,v);</span><br><span class="line">					<span class="built_in">blossom</span>(u,v,lca);</span><br><span class="line">					<span class="built_in">blossom</span>(v,u,lca);</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> _n,<span class="type">int</span> m,<span class="type">int</span> *x,<span class="type">int</span> *y,vector&lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt; &amp;vec)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">		n=_n;</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,m) <span class="built_in">add</span>(x[i],y[i]);</span><br><span class="line">		<span class="built_in">fd</span>(i,n,<span class="number">1</span>) <span class="keyword">if</span>(!matc[i]) ans+=<span class="built_in">Augument</span>(i);</span><br><span class="line">		vec.<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n) <span class="keyword">if</span>(matc[i]&amp;&amp;i&lt;matc[i]) vec.<span class="built_in">pb</span>(<span class="built_in">make_pair</span>(i,matc[i]));</span><br><span class="line">		<span class="built_in">fo</span>(i,<span class="number">1</span>,n) matc[i]=t[i]=fa[i]=pre[i]=vst[i]=<span class="number">0</span>,adj[i].<span class="built_in">clear</span>();</span><br><span class="line">		<span class="keyword">for</span>(;!q.<span class="built_in">empty</span>();q.<span class="built_in">pop</span>());</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SCC"><a href="#SCC" class="headerlink" title="SCC"></a>SCC</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Tarjan</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">	low[u]=dfn[u]=++tim; s.<span class="built_in">push</span>(u); vis[u]=<span class="literal">true</span>;</span><br><span class="line">	<span class="type">int</span> len=adj[u].<span class="built_in">size</span>(),v;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line">		<span class="keyword">if</span>(!dfn[v=adj[u][i]]) <span class="built_in">Tarjan</span>(v),low[u]=<span class="built_in">min</span>(low[u],low[v]);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(vis[v]) low[u] = <span class="built_in">min</span>(low[u],dfn[v]);</span><br><span class="line">	<span class="keyword">if</span>(dfn[u]!=low[u]) <span class="keyword">return</span>; </span><br><span class="line">	SCC_num++;</span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		v = s.<span class="built_in">top</span>(); s.<span class="built_in">pop</span>(); vis[v] = <span class="literal">false</span>;</span><br><span class="line">		SCC[SCC_num].<span class="built_in">push_back</span>(v);</span><br><span class="line">	&#125;<span class="keyword">while</span>(v!=u); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="BCC"><a href="#BCC" class="headerlink" title="BCC"></a>BCC</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    dfn[u]=low[u]=++tim; st[++top]=u;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[u],v,x;i;i=ne[i])</span><br><span class="line">        <span class="keyword">if</span>(!dfn[v=ver[i]]) &#123;</span><br><span class="line">            <span class="built_in">dfs</span>(v); low[u]=<span class="built_in">min</span>(low[u],low[v]);</span><br><span class="line">            <span class="keyword">if</span>(low[v]&gt;=dfn[u])<span class="comment">/*if(low[v]&gt;dfn[u])*/</span></span><br><span class="line">            &#123;</span><br><span class="line">                Tree::val[++n]=<span class="number">1</span>; x=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    x=st[top--]; Tree::<span class="built_in">add</span>(x,n); Tree::val[n]++;</span><br><span class="line">                &#125;<span class="keyword">while</span>(x!=v);</span><br><span class="line">                Tree::<span class="built_in">add</span>(u,n);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="comment">/*if(v!=pre)*/</span> low[u]=<span class="built_in">min</span>(low[u],dfn[v]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="树论"><a href="#树论" class="headerlink" title="树论"></a>树论</h1><h2 id="虚树"><a href="#虚树" class="headerlink" title="虚树"></a>虚树</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//虚树清空必须使用dfs清空所有东西。</span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; _adj[N];</span><br><span class="line"><span class="type">void</span> _add(<span class="type">int</span> x,<span class="type">int</span> y) &#123;</span><br><span class="line">	_adj[x].<span class="built_in">pb</span>(y); _adj[y].<span class="built_in">pb</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> rt;</span><br><span class="line"><span class="type">int</span> st[N],top;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;a)</span> </span>&#123;</span><br><span class="line">	rt=a[<span class="number">0</span>];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">auto</span> v:a) rt=<span class="built_in">lca</span>(rt,v);</span><br><span class="line">	a.<span class="built_in">pb</span>(rt);</span><br><span class="line">	<span class="built_in">sort</span>(<span class="built_in">all</span>(a),[&amp;](<span class="type">const</span> <span class="type">int</span> &amp;x,<span class="type">const</span> <span class="type">int</span> &amp;y)&#123;<span class="keyword">return</span> dfn[x]&lt;dfn[y];&#125;);</span><br><span class="line">	a.<span class="built_in">resize</span>(<span class="built_in">unique</span>(<span class="built_in">all</span>(a))-a.<span class="built_in">begin</span>());</span><br><span class="line">	top=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> y;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">auto</span> x:a) &#123;</span><br><span class="line">		<span class="keyword">if</span>(top) &#123;</span><br><span class="line">			y=<span class="built_in">lca</span>(x,st[top]);</span><br><span class="line">			<span class="keyword">if</span>(y!=st[top]) &#123;</span><br><span class="line">				<span class="keyword">for</span>(;top&gt;=<span class="number">2</span>&amp;&amp;dep[st[top<span class="number">-1</span>]]&gt;=dep[y];top--) _add(st[top],st[top<span class="number">-1</span>]);</span><br><span class="line">				<span class="keyword">if</span>(st[top]!=y) _add(st[top],y),st[top]=y;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(st[top]!=x) st[++top]=x;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(top) <span class="keyword">for</span>(;--top;) _add(st[top],st[top+<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="计算几何"><a href="#计算几何" class="headerlink" title="计算几何"></a>计算几何</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> db eps=<span class="number">1e-8</span>;</span><br><span class="line"><span class="type">const</span> db pi=<span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="type">const</span> db inf=<span class="number">1e20</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sgn</span><span class="params">(db x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">fabs</span>(x)&lt;eps) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> db <span class="title">sqr</span><span class="params">(db x)</span></span>&#123;<span class="keyword">return</span> x*x;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&#123;</span><br><span class="line">	db x,y;</span><br><span class="line">	<span class="built_in">Point</span>() &#123;x=y=<span class="number">0</span>;&#125;</span><br><span class="line">	<span class="built_in">Point</span>(db _x,db _y) &#123;x=_x,y=_y;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">input</span><span class="params">()</span></span>&#123;<span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf&quot;</span>,&amp;x,&amp;y);&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">inline</span> <span class="type">bool</span> <span class="keyword">operator</span> == (Point A,Point B)&#123;<span class="keyword">return</span> <span class="built_in">sgn</span>(A.x-B.x)==<span class="number">0</span>&amp;&amp;<span class="built_in">sgn</span>(A.y-B.y)==<span class="number">0</span>;&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">inline</span> <span class="type">bool</span> <span class="keyword">operator</span> &lt; (Point A,Point B)&#123;<span class="keyword">return</span> <span class="built_in">sgn</span>(A.x-B.x)==<span class="number">0</span>?<span class="built_in">sgn</span>(A.y-B.y)&lt;<span class="number">0</span>:A.x&lt;B.x;&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">inline</span> Point <span class="keyword">operator</span> - (Point A,Point B)&#123;<span class="keyword">return</span> <span class="built_in">Point</span>(A.x-B.x,A.y-B.y);&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">inline</span> Point <span class="keyword">operator</span> + (Point A,Point B)&#123;<span class="keyword">return</span> <span class="built_in">Point</span>(A.x+B.x,A.y+B.y);&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">inline</span> Point <span class="keyword">operator</span> * (Point A,db k)&#123;<span class="keyword">return</span> <span class="built_in">Point</span>(A.x*k,A.y*k);&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">inline</span> Point <span class="keyword">operator</span> / (Point A,db k)&#123;<span class="keyword">return</span> <span class="built_in">Point</span>(A.x/k,A.y/k);&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">inline</span> db <span class="keyword">operator</span> ^(Point A,Point B)&#123;<span class="keyword">return</span> A.x*B.y-A.y*B.x;&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">inline</span> db <span class="keyword">operator</span> *(Point A,Point B)&#123;<span class="keyword">return</span> A.x*B.x+A.y*B.y;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> db <span class="title">len2</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> x*x+y*y;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> db <span class="title">len</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">sqrt</span>(<span class="built_in">len2</span>());&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> db <span class="title">angle</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">atan2</span>(y,x);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> db <span class="title">rad</span><span class="params">(Point A,Point B)</span> </span>&#123;</span><br><span class="line">		Point P=*<span class="keyword">this</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">fabs</span>(<span class="built_in">atan2</span>((A-P)^(B-P),(A-P)*(B-P)));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> Point <span class="title">trunc</span><span class="params">(db r)</span> </span>&#123;</span><br><span class="line">		db l=<span class="built_in">len</span>(); <span class="keyword">if</span>(!<span class="built_in">sgn</span>(l)) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">		r/=l; <span class="keyword">return</span> <span class="built_in">Point</span>(x*r,y*r);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> Point <span class="title">rotate_left</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">Point</span>(-y,x);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> Point <span class="title">rotate_right</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">Point</span>(y,-x);&#125;</span><br><span class="line">	<span class="comment">//anti-clockwise</span></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> Point <span class="title">rotate</span><span class="params">(Point P,db ang)</span> </span>&#123;</span><br><span class="line">		Point v=(*<span class="keyword">this</span>)-P;</span><br><span class="line">		db c=<span class="built_in">cos</span>(ang),s=<span class="built_in">sin</span>(ang);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Point</span>(P.x+v.x*c-v.y*s,P.y+v.x*s+v.y*c);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> Point <span class="title">rotate</span><span class="params">(db ang)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">rotate</span>(<span class="built_in">Point</span>(<span class="number">0</span>,<span class="number">0</span>),ang);&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> db <span class="title">area</span><span class="params">(Point A,Point B,Point C)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">fabs</span>((A-B)^(C-B))/<span class="number">2</span>;&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Line</span>&#123;</span><br><span class="line">	Point s,e;</span><br><span class="line">	<span class="built_in">Line</span>() &#123;&#125;</span><br><span class="line">	<span class="built_in">Line</span>(Point _s,Point _e) &#123;s=_s; e=_e;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">input</span><span class="params">()</span></span>&#123;s.<span class="built_in">input</span>();e.<span class="built_in">input</span>();&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">adjust</span><span class="params">()</span></span>&#123;<span class="keyword">if</span>(e&lt;s) <span class="built_in">swap</span>(e,s);&#125;</span><br><span class="line">	<span class="keyword">friend</span> <span class="keyword">inline</span> <span class="type">bool</span> <span class="keyword">operator</span>==(Line A,Line B)&#123;<span class="keyword">return</span> A.s==B.s&amp;&amp;A.e==B.e;&#125;</span><br><span class="line">	<span class="built_in">Line</span>(Point p,db ang) &#123;</span><br><span class="line">		s=p;</span><br><span class="line">		e=p+(<span class="built_in">sgn</span>(ang-pi/<span class="number">2</span>)==<span class="number">0</span>?<span class="built_in">Point</span>(<span class="number">0</span>,<span class="number">1</span>):<span class="built_in">Point</span>(<span class="number">1</span>,<span class="built_in">tan</span>(ang)));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">Line</span>(db a,db b,db c) &#123; <span class="comment">//ax+by+c==0 </span></span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">sgn</span>(a)==<span class="number">0</span>) s=<span class="built_in">Point</span>(<span class="number">0</span>,-c/b),e=<span class="built_in">Point</span>(<span class="number">1</span>,-c/b);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">sgn</span>(b)==<span class="number">0</span>) s=<span class="built_in">Point</span>(-c/a,<span class="number">0</span>),e=<span class="built_in">Point</span>(-c/a,<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">else</span> s=<span class="built_in">Point</span>(<span class="number">0</span>,-c/b),e=<span class="built_in">Point</span>(<span class="number">1</span>,(-c-a)/b);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> db <span class="title">len</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> (e-s).<span class="built_in">len</span>();&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> db <span class="title">angle2</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="built_in">atan2</span>(e.y-s.y,e.x-s.x);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> db <span class="title">angle</span><span class="params">()</span> </span>&#123; <span class="comment">//angle in [0,pi)</span></span><br><span class="line">		db k=<span class="built_in">angle2</span>();</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">sgn</span>(k)&lt;<span class="number">0</span>) k+=pi;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">sgn</span>(k-pi)==<span class="number">0</span>) k-=pi;</span><br><span class="line">		<span class="keyword">return</span> k;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">relation</span><span class="params">(Point p)</span> </span>&#123; <span class="comment">//1:p on line&#x27;s left;3:p on line</span></span><br><span class="line">		<span class="type">int</span> c=<span class="built_in">sgn</span>((p-s)^(e-s));</span><br><span class="line">		<span class="keyword">return</span> !c?<span class="number">3</span>:<span class="number">1</span>+(c&gt;<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">PointOnSegment</span><span class="params">(Point p)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">sgn</span>((p-s)^(e-s))==<span class="number">0</span>&amp;&amp;<span class="built_in">sgn</span>((p-s)*(p-e))&lt;=<span class="number">0</span>;&#125;</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">parallel</span><span class="params">(Line v)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">sgn</span>((e-s)^(v.e-v.s))==<span class="number">0</span>;&#125;</span><br><span class="line">	<span class="comment">// 2 规范相交；1 非规范相交；0 不相交</span></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">segcrossseg</span><span class="params">(Line v)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> d1 = <span class="built_in">sgn</span>((e-s)^(v.s-s));</span><br><span class="line">        <span class="type">int</span> d2 = <span class="built_in">sgn</span>((e-s)^(v.e-s));</span><br><span class="line">        <span class="type">int</span> d3 = <span class="built_in">sgn</span>((v.e-v.s)^(s-v.s));</span><br><span class="line">        <span class="type">int</span> d4 = <span class="built_in">sgn</span>((v.e-v.s)^(e-v.s));</span><br><span class="line">        <span class="keyword">if</span>( (d1^d2)==<span class="number">-2</span> &amp;&amp; (d3^d4)==<span class="number">-2</span> )<span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">return</span> (d1==<span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>((v.s-s)*(v.s-e))&lt;=<span class="number">0</span>) ||</span><br><span class="line">            (d2==<span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>((v.e-s)*(v.e-e))&lt;=<span class="number">0</span>) ||</span><br><span class="line">            (d3==<span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>((s-v.s)*(s-v.e))&lt;=<span class="number">0</span>) ||</span><br><span class="line">            (d4==<span class="number">0</span> &amp;&amp; <span class="built_in">sgn</span>((e-v.s)*(e-v.e))&lt;=<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">linecrossseg</span><span class="params">(Line v)</span> </span>&#123; <span class="comment">//*this is line </span></span><br><span class="line">		<span class="type">int</span> d1 = <span class="built_in">sgn</span>((e-s)^(v.s-s));</span><br><span class="line">        <span class="type">int</span> d2 = <span class="built_in">sgn</span>((e-s)^(v.e-s));</span><br><span class="line">        <span class="keyword">if</span>((d1^d2)==<span class="number">-2</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">return</span> (d1==<span class="number">0</span>||d2==<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">linecrossline</span><span class="params">(Line v)</span> </span>&#123; <span class="comment">//0 平行；1 重合；2 相交 </span></span><br><span class="line">		<span class="keyword">if</span>((*<span class="keyword">this</span>).<span class="built_in">parallel</span>(v)) <span class="keyword">return</span> v.<span class="built_in">relation</span>(s)==<span class="number">3</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">Point <span class="title">Intersection</span><span class="params">(Line v)</span> </span>&#123;</span><br><span class="line">		db a1=(v.e-v.s)^(s-v.s);</span><br><span class="line">        db a2=(v.e-v.s)^(e-v.s);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Point</span>((s.x*a2-e.x*a1)/(a2-a1),(s.y*a2-e.y*a1)/(a2-a1));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">db <span class="title">dispointtoline</span><span class="params">(Point p)</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">fabs</span>((p-s)^(e-s))/<span class="built_in">len</span>();&#125;<span class="comment">//点到直线的距离</span></span><br><span class="line">    <span class="function">db <span class="title">dispointtoseg</span><span class="params">(Point p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sgn</span>((p-s)*(e-s))&lt;<span class="number">0</span> || <span class="built_in">sgn</span>((p-e)*(s-e))&lt;<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">min</span>((p-s).<span class="built_in">len</span>(),(p-e).<span class="built_in">len</span>());</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dispointtoline</span>(p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//`返回线段到线段的距离`</span></span><br><span class="line">    <span class="comment">//`前提是两线段不相交，相交距离就是0了`</span></span><br><span class="line">    <span class="function">db <span class="title">dissegtoseg</span><span class="params">(Line v)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(<span class="built_in">min</span>(<span class="built_in">dispointtoseg</span>(v.s),<span class="built_in">dispointtoseg</span>(v.e)),<span class="built_in">min</span>(v.<span class="built_in">dispointtoseg</span>(s),v.<span class="built_in">dispointtoseg</span>(e)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//点p在直线上的投影</span></span><br><span class="line">    <span class="function">Point <span class="title">lineprog</span><span class="params">(Point p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> s + ( ((e-s)*((e-s)*(p-s)))/((e-s).<span class="built_in">len2</span>()) );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//点p关于直线的对称点</span></span><br><span class="line">    <span class="function">Point <span class="title">symmetrypoint</span><span class="params">(Point p)</span> </span>&#123;</span><br><span class="line">        Point q = <span class="built_in">lineprog</span>(p);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Point</span>(<span class="number">2</span>*q.x-p.x,<span class="number">2</span>*q.y-p.y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span>&#123;</span><br><span class="line">    Point p; db r;</span><br><span class="line">    <span class="built_in">Circle</span>()&#123;&#125;</span><br><span class="line">    <span class="built_in">Circle</span>(Point p,db r)&#123;<span class="keyword">this</span>-&gt;p=p; <span class="keyword">this</span>-&gt;r=r;&#125;</span><br><span class="line">    <span class="built_in">Circle</span>(db x,db y,db r)&#123;p=<span class="built_in">Point</span>(x,y); <span class="keyword">this</span>-&gt;r=r;&#125;</span><br><span class="line">    <span class="built_in">Circle</span>(Point a,Point b,Point c,<span class="type">bool</span> opt) &#123;<span class="comment">//0 外接圆；1 内切圆</span></span><br><span class="line">        Line u,v;</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">0</span>) &#123;</span><br><span class="line">            u=<span class="built_in">Line</span>((a+b)/<span class="number">2</span>,((a+b)/<span class="number">2</span>)+((b-a).<span class="built_in">rotate_left</span>()));</span><br><span class="line">            v=<span class="built_in">Line</span>((b+c)/<span class="number">2</span>,((b+c)/<span class="number">2</span>)+((c-b).<span class="built_in">rotate_left</span>()));</span><br><span class="line">            p=u.<span class="built_in">Intersection</span>(v);</span><br><span class="line">            r=(p-a).<span class="built_in">len</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            db m = <span class="built_in">atan2</span>(b.y-a.y,b.x-a.x), n = <span class="built_in">atan2</span>(c.y-a.y,c.x-a.x);</span><br><span class="line">            u.s = a;</span><br><span class="line">            u.e = u.s + <span class="built_in">Point</span>(<span class="built_in">cos</span>((n+m)/<span class="number">2</span>),<span class="built_in">sin</span>((n+m)/<span class="number">2</span>));</span><br><span class="line">            v.s = b;</span><br><span class="line">            m = <span class="built_in">atan2</span>(a.y-b.y,a.x-b.x) , n = <span class="built_in">atan2</span>(c.y-b.y,c.x-b.x);</span><br><span class="line">            v.e = v.s + <span class="built_in">Point</span>(<span class="built_in">cos</span>((n+m)/<span class="number">2</span>),<span class="built_in">sin</span>((n+m)/<span class="number">2</span>));</span><br><span class="line">            p = u.<span class="built_in">Intersection</span>(v);</span><br><span class="line">            r = <span class="built_in">Line</span>(a,b).<span class="built_in">dispointtoseg</span>(p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">inline</span> <span class="type">bool</span> <span class="keyword">operator</span> == (Circle A,Circle B) &#123;<span class="keyword">return</span> A.p==B.p&amp;&amp;<span class="built_in">sgn</span>(A.r-B.r)==<span class="number">0</span>;&#125;</span><br><span class="line">    <span class="function">db <span class="title">area</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> pi*r*r;&#125;</span><br><span class="line">    <span class="function">db <span class="title">circumference</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="number">2</span>*pi*r;&#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">relation</span><span class="params">(Point b)</span> </span>&#123; <span class="comment">//0 圆外；1 圆上；2 圆内</span></span><br><span class="line">        <span class="type">int</span> opt=<span class="built_in">sgn</span>((b-p).<span class="built_in">len</span>()-r);</span><br><span class="line">        <span class="keyword">return</span> opt&lt;<span class="number">0</span>?<span class="number">2</span>:(opt==<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">relationseg</span><span class="params">(Line v)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> opt=<span class="built_in">sgn</span>(v.<span class="built_in">dispointtoseg</span>(p)-r);</span><br><span class="line">        <span class="keyword">return</span> opt&lt;<span class="number">0</span>?<span class="number">2</span>:(opt==<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">relationline</span><span class="params">(Line v)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> opt=<span class="built_in">sgn</span>(v.<span class="built_in">dispointtoline</span>(p)-r);</span><br><span class="line">        <span class="keyword">return</span> opt&lt;<span class="number">0</span>?<span class="number">2</span>:(opt==<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 5 相离</span></span><br><span class="line">	<span class="comment">// 4 外切</span></span><br><span class="line">	<span class="comment">// 3 相交</span></span><br><span class="line">	<span class="comment">// 2 内切</span></span><br><span class="line">	<span class="comment">// 1 内含</span></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">relationcircle</span><span class="params">(Circle A)</span> </span>&#123;</span><br><span class="line">		db d=(p-A.p).<span class="built_in">len</span>();</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">sgn</span>(d-r-A.r)&gt;<span class="number">0</span>) <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">sgn</span>(d-r-A.r)==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">2</span>+<span class="built_in">sgn</span>(d-<span class="built_in">fabs</span>(r-A.r));</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="function">vector&lt;Point&gt; <span class="title">pointcrossline</span><span class="params">(Line v)</span> </span>&#123;</span><br><span class="line">        vector&lt;Point&gt; vec; vec.<span class="built_in">clear</span>();</span><br><span class="line">        <span class="keyword">if</span>(!(*<span class="keyword">this</span>).<span class="built_in">relationline</span>(v)) <span class="keyword">return</span> vec;</span><br><span class="line">        Point a=v.<span class="built_in">lineprog</span>(p);</span><br><span class="line">        db d=v.<span class="built_in">dispointtoline</span>(p);</span><br><span class="line">        d=<span class="built_in">sqrt</span>(r*r-d*d);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sgn</span>(d)==<span class="number">0</span>) vec.<span class="built_in">pb</span>(a);</span><br><span class="line">        <span class="keyword">else</span> vec.<span class="built_in">pb</span>(a+(v.e-v.s).<span class="built_in">trunc</span>(d)),vec.<span class="built_in">pb</span>(a-(v.e-v.s).<span class="built_in">trunc</span>(d));</span><br><span class="line">        <span class="keyword">return</span> vec;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="function">vector&lt;Point&gt; <span class="title">pointcrosscircle</span><span class="params">(Circle A)</span> </span>&#123;</span><br><span class="line">		vector&lt;Point&gt; vec; vec.<span class="built_in">clear</span>();</span><br><span class="line">		<span class="type">int</span> t=<span class="built_in">relationcircle</span>(A);</span><br><span class="line">		<span class="keyword">if</span>(t==<span class="number">5</span>||t==<span class="number">1</span>) <span class="keyword">return</span> vec;</span><br><span class="line">		db d=(p-A.p).<span class="built_in">len</span>();</span><br><span class="line">		db l=(d*d+r*r-A.r*A.r)/(<span class="number">2.</span>*d);</span><br><span class="line">		db h=<span class="built_in">sqrt</span>(r*r-l*l);</span><br><span class="line">		Point q=p+(A.p-p).<span class="built_in">trunc</span>(l);</span><br><span class="line">		<span class="keyword">if</span>(t==<span class="number">2</span>||t==<span class="number">4</span>) &#123;</span><br><span class="line">			vec.<span class="built_in">pb</span>(q); <span class="keyword">return</span> vec;</span><br><span class="line">		&#125;</span><br><span class="line">		vec.<span class="built_in">pb</span>(q+((A.p-p).<span class="built_in">rotate_left</span>()).<span class="built_in">trunc</span>(h));</span><br><span class="line">		vec.<span class="built_in">pb</span>(q+((A.p-p).<span class="built_in">rotate_right</span>()).<span class="built_in">trunc</span>(h));</span><br><span class="line">		<span class="keyword">return</span> vec;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//最小圆覆盖</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> Circle <span class="title">smallestcircle</span><span class="params">(Point *_p,<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="function">vector&lt;Point&gt; <span class="title">p</span><span class="params">(n)</span></span>;</span><br><span class="line">	<span class="built_in">fo</span>(i,<span class="number">1</span>,n) p[i<span class="number">-1</span>]=_p[i];</span><br><span class="line">	<span class="built_in">random_shuffle</span>(<span class="built_in">all</span>(p));</span><br><span class="line">	Circle C=<span class="built_in">Circle</span>(p[<span class="number">0</span>],<span class="number">0.0</span>);</span><br><span class="line">	<span class="built_in">ff</span>(i,<span class="number">1</span>,n)</span><br><span class="line">		<span class="keyword">if</span>(C.<span class="built_in">relation</span>(p[i])==<span class="number">0</span>) &#123;</span><br><span class="line">			C=<span class="built_in">Circle</span>(p[i],<span class="number">0.0</span>);</span><br><span class="line">			<span class="built_in">fo</span>(j,<span class="number">0</span>,i<span class="number">-1</span>)</span><br><span class="line">				<span class="keyword">if</span>(C.<span class="built_in">relation</span>(p[j])==<span class="number">0</span>) &#123;</span><br><span class="line">					C=<span class="built_in">Circle</span>((p[i]+p[j])/<span class="number">2</span>,(p[i]-p[j]).<span class="built_in">len</span>()/<span class="number">2</span>);</span><br><span class="line">					<span class="built_in">fo</span>(k,<span class="number">0</span>,j<span class="number">-1</span>)</span><br><span class="line">						<span class="keyword">if</span>(C.<span class="built_in">relation</span>(p[k])==<span class="number">0</span>)</span><br><span class="line">							C=<span class="built_in">Circle</span>(p[i],p[j],p[k],<span class="number">0</span>);</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Polygon</span> &#123;</span><br><span class="line">	<span class="type">int</span> n;</span><br><span class="line">	vector&lt;Point&gt; p;</span><br><span class="line">	vector&lt;Line&gt; l;</span><br><span class="line">	<span class="built_in">Polygon</span>(vector&lt;Point&gt; a) &#123;</span><br><span class="line">		n=a.<span class="built_in">size</span>(); p=a; l.<span class="built_in">resize</span>(n);</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) l[i]=<span class="built_in">Line</span>(p[i],p[(i+<span class="number">1</span>)%n]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">db <span class="title">area</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		db ans=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;n;i++) ans+=(p[i]-p[<span class="number">0</span>])^(p[i<span class="number">-1</span>]-p[<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">fabs</span>(ans)/<span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function">Polygon <span class="title">ConvexHull</span><span class="params">(vector&lt;Point&gt; a)</span> </span>&#123;<span class="comment">//是否用 vector&lt;Point&gt; &amp;a 取决于是否需要改变 a</span></span><br><span class="line">    <span class="type">int</span> n = a.<span class="built_in">size</span>(), m = <span class="number">0</span>;</span><br><span class="line">    <span class="function">vector&lt;Point&gt; <span class="title">p</span><span class="params">(n*<span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="built_in">sort</span>(<span class="built_in">all</span>(a));</span><br><span class="line">    <span class="built_in">ff</span>(i,<span class="number">0</span>,n) &#123;</span><br><span class="line">        <span class="keyword">for</span>(;m &gt; <span class="number">1</span> &amp;&amp; ((p[m<span class="number">-2</span>] - p[m<span class="number">-1</span>]) ^ (p[m<span class="number">-1</span>] - a[i])) &lt;= <span class="number">0</span>; m--);</span><br><span class="line">        p[m++] = a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> k = m;</span><br><span class="line">    <span class="built_in">fd</span>(i,n<span class="number">-1</span>,<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span>(;m &gt; k &amp;&amp; ((p[m<span class="number">-2</span>] - p[m<span class="number">-1</span>]) ^ (p[m<span class="number">-1</span>] - a[i])) &lt;= <span class="number">0</span>; m--);</span><br><span class="line">        p[m++] = a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">resize</span>(m<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Polygon</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Polygon <span class="title">HalfPlanes</span><span class="params">(vector&lt;Line&gt; l)</span> </span>&#123;</span><br><span class="line">	vector&lt;Point&gt; p;</span><br><span class="line">	<span class="type">int</span> n=l.<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">auto</span> cmp = [](Line A,Line B) &#123;</span><br><span class="line">		db r=A.<span class="built_in">angle2</span>()-B.<span class="built_in">angle2</span>();</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">sgn</span>(r)!=<span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">sgn</span>(r)&lt;<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sgn</span>((A.e-A.s)^(B.e-A.s))&lt;<span class="number">0</span>;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="built_in">sort</span>(<span class="built_in">all</span>(l),cmp);</span><br><span class="line">	<span class="function">vector&lt;Line&gt; <span class="title">q</span><span class="params">(n+<span class="number">2</span>)</span></span>;</span><br><span class="line">	<span class="function">vector&lt;Point&gt; <span class="title">b</span><span class="params">(n+<span class="number">2</span>)</span></span>;</span><br><span class="line">	<span class="type">int</span> head=<span class="number">0</span>,tail=<span class="number">0</span>;</span><br><span class="line">	q[<span class="number">0</span>]=l[<span class="number">0</span>];</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++)</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">sgn</span>(l[i].<span class="built_in">angle2</span>()-l[i<span class="number">-1</span>].<span class="built_in">angle2</span>())!=<span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(head&lt;tail&amp;&amp;q[head].<span class="built_in">parallel</span>(q[head+<span class="number">1</span>])) <span class="keyword">return</span> <span class="built_in">Polygon</span>(p);</span><br><span class="line">			<span class="keyword">if</span>(head&lt;tail&amp;&amp;q[tail].<span class="built_in">parallel</span>(q[tail<span class="number">-1</span>])) <span class="keyword">return</span> <span class="built_in">Polygon</span>(p);</span><br><span class="line">			<span class="keyword">while</span>(head&lt;tail&amp;&amp;l[i].<span class="built_in">relation</span>(b[tail<span class="number">-1</span>])==<span class="number">2</span>) tail--;</span><br><span class="line">			<span class="keyword">while</span>(head&lt;tail&amp;&amp;l[i].<span class="built_in">relation</span>(b[head])==<span class="number">2</span>) head++;</span><br><span class="line">			q[++tail]=l[i];</span><br><span class="line">			<span class="keyword">if</span>(head&lt;tail) b[tail<span class="number">-1</span>]=q[tail].<span class="built_in">Intersection</span>(q[tail<span class="number">-1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">while</span>(head&lt;tail&amp;&amp;l[head].<span class="built_in">relation</span>(b[tail<span class="number">-1</span>])==<span class="number">2</span>) tail--;</span><br><span class="line">	<span class="keyword">while</span>(head&lt;tail&amp;&amp;l[tail].<span class="built_in">relation</span>(b[head])==<span class="number">2</span>) head++;</span><br><span class="line">	<span class="keyword">if</span>(tail-head&lt;=<span class="number">1</span>) <span class="keyword">return</span> <span class="built_in">Polygon</span>(p);</span><br><span class="line">	b[tail]=q[head].<span class="built_in">Intersection</span>(q[tail]);</span><br><span class="line">	p.<span class="built_in">resize</span>(tail-head+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=head;i&lt;=tail;i++) p[i-head]=b[i];</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">Polygon</span>(p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
      


    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/Codeforces-Global-Round-14-CF1515/" rel="prev" title="Codeforces Global Round 14[CF1515]">
                  <i class="fa fa-chevron-left"></i> Codeforces Global Round 14[CF1515]
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022-Huawei-ICPC-Camp/" rel="next" title="2022 Huawei ICPC Camp">
                  2022 Huawei ICPC Camp <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2019 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Oql</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.8/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>




  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.1/es5/tex-mml-chtml.js","integrity":"sha256-hlC2uSQYTmPsrzGZTEQEg9PZ1a/+SV6VBCTclohf2og="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
